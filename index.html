<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>楓之谷BOSS重生時間系統</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="container">
        <div class="tabs">
            <div class="tab active" onclick="switchTab(0)">BOSS記錄</div>
            <div class="tab" onclick="switchTab(1)">BOSS列表</div>
            <div class="tab" onclick="switchTab(2)">擊殺統計</div>
            <div class="tab" onclick="switchTab(3)">通知設定</div>
            <div class="tab" onclick="switchTab(4)">改善建議</div>
        </div>

        <div class="tab-content active" id="tab-record">
            <div class="section">
                <h2>快速記錄 BOSS 擊殺</h2>
                <div class="quick-input-row">
                    <div class="input-field">
                        <label>選擇BOSS:</label>
                        <select id="boss-select" onchange="onBossSelected()">
                            <option value="">請選擇...</option>
                        </select>
                    </div>
                    <div class="input-field">
                        <label>頻道:</label>
                        <div style="display: flex; gap: 8px;">
                            <input type="number" id="channel-input" min="1" max="9999" step="1" style="flex: 1;" placeholder="頻道號碼">
                            <button type="button" id="monitor-btn" onclick="toggleScreenMonitor()" class="capture-btn" title="開始/停止螢幕監控">
                                🎯
                            </button>
                            <button type="button" onclick="adjustScanArea()" class="capture-btn" title="調整掃描位置" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border-color: #8b5cf6;">
                                ⚙️
                            </button>
                            <button type="button" onclick="previewScanArea()" class="capture-btn" title="預覽掃描區域" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-color: #f59e0b;">
                                👁️
                            </button>
                            <button type="button" onclick="showOcrHelp()" class="capture-btn" title="使用說明" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); border-color: #6b7280;">
                                ❓
                            </button>
                        </div>
                        <div id="scan-preview" style="display:none; margin-top:10px; padding:10px; background:#1a1a2e; border-radius:8px;">
                            <div style="color:#888; margin-bottom:5px;">掃描區域預覽：<span id="preview-countdown" style="color:#10b981;"></span></div>
                            <img id="preview-img" style="max-width:100%; border:2px solid #10b981; border-radius:4px;">
                        </div>
                    </div>
                    <button type="button" onclick="recordBoss()" style="background: linear-gradient(135deg, #0099cc 0%, #0077aa 100%); border-color: #0099cc;">
                        📝 記錄擊殺
                    </button>
                </div>

                <div class="map-select-wrapper" id="map-select-container" style="display: none;">
                    <label>🗺️ 選擇地圖位置:</label>
                    <select id="map-select">
                        <option value="7">夜市徒步區7</option>
                        <option value="7-1">夜市徒步區7-1</option>
                    </select>
                </div>

                <div class="info-box" id="boss-info" style="display: none;">
                    <div class="boss-select-preview">
                        <img id="boss-preview-image" src="" alt="BOSS預覽" style="display: none;">
                        <div>
                            <p id="map-info"></p>
                            <p id="time-info"></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">當前記錄中的BOSS (<span id="boss-count">0</span>)</h2>
                    <button type="button" onclick="clearAll()" class="danger" style="margin: 0;">⚠️ 清空所有記錄</button>
                </div>
                <div id="record-container" style="display: grid; gap: 16px;">
                    <!-- 卡片將通過JavaScript動態生成 -->
                </div>
            </div>
        </div>

        <div class="tab-content" id="tab-settings">
            <div class="section">
                <h2>BOSS資訊一覽</h2>
                <div style="overflow-x: auto;">
                    <table id="boss-list-table">
                        <thead>
                            <tr>
                                <th style="width: 60px;">圖片</th>
                                <th>BOSS名稱</th>
                                <th>重生時間範圍</th>
                                <th>地圖</th>
                            </tr>
                        </thead>
                        <tbody id="boss-list-tbody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-content" id="tab-statistics">
            <div class="section">
                <div class="stats-header">
                    <h2>📊 BOSS擊殺統計</h2>
                    <div class="button-group" style="margin: 0;">
                        <button type="button" onclick="resetTodayStats()">🔄 重置今日統計</button>
                        <button type="button" onclick="resetAllStats()" class="danger">⚠️ 清空所有統計</button>
                    </div>
                </div>
                
                <div class="info-box">
                    <p>📅 統計日期: <span id="stats-date"></span></p>
                    <p>🎯 今日總擊殺: <span id="total-today-kills" style="color: #ff9800; font-weight: bold; font-size: 1.2em;">0</span> 次</p>
                    <p>🏆 累積總擊殺: <span id="total-all-kills" style="color: #00ff99; font-weight: bold; font-size: 1.2em;">0</span> 次</p>
                </div>

                <div class="stats-grid" id="stats-grid">
                    <!-- 統計卡片將在這裡動態生成 -->
                </div>
            </div>
        </div>

        <div class="tab-content" id="tab-notification">
            <div class="section">
                <h2>🔔 Discord 通知設定</h2>
                <p style="color: #a0a0c0; margin-bottom: 20px;">
                    設定您的 Discord Webhook，即可在擊殺BOSS時自動接收通知到您的Discord頻道！
                </p>

                <div class="info-box" style="background: rgba(16, 185, 129, 0.1); border-left-color: #10b981;">
                    <p style="color: #10b981; font-weight: bold; margin-bottom: 10px;">📢 統一通知 Webhook</p>
                    <p style="color: #cbd5e1; font-size: 0.95em; margin-bottom: 5px;">
                        此 Webhook 會接收<strong>所有BOSS</strong>的擊殺通知，方便集中管理。
                    </p>
                </div>

                <div class="input-group" style="margin-top: 20px;">
                    <div class="input-field" style="grid-column: 1 / -1;">
                        <label style="font-size: 1.05em; color: #0099cc; font-weight: bold;">
                            🔗 Discord Webhook URL:
                        </label>
                        <input type="text" id="user-webhook-url" 
                               placeholder="https://discord.com/api/webhooks/..."
                               style="width: 100%; font-family: monospace; font-size: 0.9em;">
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" onclick="saveUserWebhook()" 
                            style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-color: #10b981; padding: 15px 30px; font-size: 1.1em;">
                        💾 儲存設定
                    </button>
                    <button type="button" onclick="testUserWebhook()" 
                            style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-color: #f59e0b; padding: 15px 30px; font-size: 1.1em;">
                        🧪 測試通知
                    </button>
                    <button type="button" onclick="clearUserWebhook()" class="danger"
                            style="padding: 15px 30px; font-size: 1.1em;">
                        🗑️ 清除設定
                    </button>
                </div>

                <div id="webhook-status" style="display: none; margin-top: 15px;" class="info-box">
                    <p id="webhook-status-text"></p>
                </div>

                <!-- 個別 BOSS 通知設定 -->
                <div class="section" style="margin-top: 30px; background: rgba(139, 92, 246, 0.05); border: 1px solid rgba(139, 92, 246, 0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3 style="color: #a78bfa; margin-bottom: 8px;">🎯 個別 BOSS 通知設定</h3>
                            <p style="color: #cbd5e1; font-size: 0.9em;">
                                為每個 BOSS 設定專屬的 Webhook（選用）| 已設定：<span id="individual-webhook-count" style="color: #10b981; font-weight: bold;">0</span> / <span id="total-boss-count">0</span>
                            </p>
                        </div>
                        <button type="button" onclick="toggleIndividualWebhooks()" id="toggle-individual-btn"
                                style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border-color: #8b5cf6; padding: 10px 20px;">
                            📂 展開設定
                        </button>
                    </div>

                    <div id="individual-webhooks-container" style="display: none;">
                        <div class="info-box" style="background: rgba(245, 158, 11, 0.1); border-left-color: #f59e0b; margin-bottom: 20px;">
                            <p style="color: #fbbf24; font-size: 0.95em;">
                                💡 <strong>提示：</strong>個別設定會覆蓋統一通知。如果某個 BOSS 沒有設定專屬 Webhook，會自動使用上方的統一通知。
                            </p>
                        </div>

                        <div class="button-group" style="margin-bottom: 20px;">
                            <button type="button" onclick="saveAllIndividualWebhooks()" 
                                    style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-color: #10b981;">
                                💾 儲存所有設定
                            </button>
                            <button type="button" onclick="clearAllIndividualWebhooks()" class="danger">
                                🗑️ 清除所有個別設定
                            </button>
                        </div>

                        <div id="boss-webhooks-list" style="display: grid; gap: 15px;">
                            <!-- BOSS Webhook 輸入框將在這裡動態生成 -->
                        </div>
                    </div>
                </div>

                <!-- 使用教學 -->
                <div class="section" style="margin-top: 30px; background: rgba(139, 92, 246, 0.05); border: 1px solid rgba(139, 92, 246, 0.3);">
                    <h3 style="color: #a78bfa; margin-bottom: 15px;">📚 使用教學</h3>
                    
                    <div style="color: #cbd5e1; line-height: 1.8;">
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #10b981; margin-bottom: 20px;">
                            <p style="color: #34d399; font-weight: bold; margin-bottom: 8px;">🎯 三種通知方式說明</p>
                            <ul style="margin-left: 20px; color: #6ee7b7;">
                                <li><strong>統一通知</strong>：所有 BOSS 都發送到同一個頻道（適合懶人、個人使用）</li>
                                <li><strong>個別通知</strong>：每個 BOSS 發送到專屬頻道（適合精細管理、團隊分工）</li>
                                <li><strong>混合使用</strong>：兩種可以同時設定，互不影響（最大彈性）</li>
                            </ul>
                        </div>

                        <p style="font-weight: bold; color: #a78bfa; margin-bottom: 10px;">🔹 步驟一：建立 Discord Webhook</p>
                        <ol style="margin-left: 20px; margin-bottom: 20px;">
                            <li>打開你的 Discord 伺服器</li>
                            <li>在想要接收通知的頻道上點擊「編輯頻道」⚙️</li>
                            <li>選擇「整合」→「Webhook」</li>
                            <li>點擊「建立 Webhook」或「新增 Webhook」</li>
                            <li>設定 Webhook 名稱（例如：楓之谷BOSS通知）</li>
                            <li>點擊「複製 Webhook 網址」📋</li>
                        </ol>

                        <p style="font-weight: bold; color: #a78bfa; margin-bottom: 10px;">🔹 步驟二：選擇通知方式並設定</p>
                        
                        <div style="background: #0a0a1a; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <p style="color: #10b981; font-weight: bold; margin-bottom: 8px;">💚 推薦：統一通知（適合大多數人）</p>
                            <ol style="margin-left: 20px; color: #6ee7b7;">
                                <li>將 Webhook 網址貼到上方「統一通知」的輸入框</li>
                                <li>點擊「💾 儲存設定」</li>
                                <li>點擊「🧪 測試通知」確認</li>
                            </ol>
                            <p style="color: #34d399; margin-top: 8px; font-size: 0.9em;">✨ 這樣所有 BOSS 的通知都會發送到這個頻道！</p>
                        </div>

                        <div style="background: #0a0a1a; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <p style="color: #a78bfa; font-weight: bold; margin-bottom: 8px;">💜 進階：個別通知（需要精細管理）</p>
                            <ol style="margin-left: 20px; color: #c4b5fd;">
                                <li>點擊「📂 展開設定」按鈕</li>
                                <li>為需要的 BOSS 單獨貼上 Webhook 網址</li>
                                <li>點擊「💾 儲存所有設定」</li>
                                <li>可以單獨測試每個 BOSS 的通知</li>
                            </ol>
                            <p style="color: #a78bfa; margin-top: 8px; font-size: 0.9em;">✨ 有設定個別的就發送到個別頻道，沒設定的會用統一通知！</p>
                        </div>

                        <p style="font-weight: bold; color: #a78bfa; margin-bottom: 10px;">🔹 Webhook 網址格式範例：</p>
                        <div style="background: #0a0a1a; padding: 12px; border-radius: 5px; font-family: monospace; font-size: 0.85em; margin-bottom: 20px; overflow-x: auto;">
                            https://discord.com/api/webhooks/1234567890123456789/AbCdEfGhIjKlMnOpQrStUvWxYz1234567890
                        </div>

                        <p style="font-weight: bold; color: #a78bfa; margin-bottom: 10px;">🔹 通知發送邏輯：</p>
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <p style="color: #60a5fa; margin-bottom: 10px;">當你記錄 BOSS 擊殺時，系統會：</p>
                            <ol style="margin-left: 20px; color: #93c5fd;">
                                <li>如果有設定該 BOSS 的<strong>個別 Webhook</strong> → 發送到個別頻道</li>
                                <li>如果有設定<strong>統一 Webhook</strong> → 也發送到統一頻道</li>
                                <li>兩種可以同時接收（互不影響）</li>
                            </ol>
                        </div>

                        <p style="font-weight: bold; color: #a78bfa; margin-bottom: 10px;">🔹 通知內容說明：</p>
                        <ul style="margin-left: 20px; margin-bottom: 20px;">
                            <li>✅ 每次記錄 BOSS 擊殺時自動發送通知</li>
                            <li>✅ 顯示 BOSS 名稱、頻道、地圖位置</li>
                            <li>✅ 顯示預計重生時間範圍</li>
                            <li>✅ 使用 BOSS 專屬顏色的訊息嵌入</li>
                        </ul>

                        <div style="background: rgba(245, 158, 11, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #f59e0b; margin-top: 20px;">
                            <p style="color: #fbbf24; font-weight: bold; margin-bottom: 8px;">⚠️ 注意事項：</p>
                            <ul style="margin-left: 20px; color: #fcd34d;">
                                <li>請勿將 Webhook 網址分享給他人</li>
                                <li>Webhook 設定僅儲存在你的瀏覽器中</li>
                                <li>清除瀏覽器資料會同時清除 Webhook 設定</li>
                                <li>個別設定會覆蓋統一通知（但兩個都會發送，如果都有設定）</li>
                            </ul>
                        </div>

                        <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #10b981; margin-top: 15px;">
                            <p style="color: #34d399; font-weight: bold; margin-bottom: 8px;">💡 使用建議：</p>
                            <ul style="margin-left: 20px; color: #6ee7b7;">
                                <li><strong>個人玩家</strong>：只設定統一通知即可</li>
                                <li><strong>團隊合作</strong>：設定統一通知到團隊頻道</li>
                                <li><strong>精細管理</strong>：重要 BOSS 設定個別通知，其他用統一</li>
                                <li><strong>多重通知</strong>：兩種都設定，確保不會錯過任何通知</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="tab-feedback">
            <div class="section">
                <h2>💡 改善建議</h2>
                <p style="color: #a0a0c0; margin-bottom: 20px;">
                    如果您在使用過程中有任何改善建議或發現問題，歡迎透過下方表單告訴我們！
                </p>
                
                <div class="input-group">
                    <div class="input-field" style="grid-column: 1 / -1;">
                        <label>建議類型:</label>
                        <select id="feedback-type" style="width: 100%;">
                            <option value="功能建議">功能建議</option>
                            <option value="錯誤回報">錯誤回報</option>
                            <option value="UI/UX改善">UI/UX改善</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                </div>

                <div class="input-group">
                    <div class="input-field" style="grid-column: 1 / -1;">
                        <label>詳細說明:</label>
                        <textarea id="feedback-content" 
                                  style="width: 100%; min-height: 150px; padding: 10px; 
                                         background: #0a0a1a; border: 1px solid #00ccff; 
                                         border-radius: 5px; color: #ffffff; font-family: inherit; 
                                         font-size: 1em; resize: vertical;"
                                  placeholder="請詳細描述您的建議或問題..."></textarea>
                    </div>
                </div>

                <div class="input-group">
                    <div class="input-field">
                        <label>聯絡方式 (選填):</label>
                        <input type="text" id="feedback-contact" 
                               placeholder="Email、遊戲ID 或其他聯絡方式"
                               style="width: 100%;">
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" onclick="submitFeedback()" style="padding: 15px 30px; font-size: 1.1em;">
                        📨 提交建議
                    </button>
                    <button type="button" onclick="clearFeedbackForm()" class="danger">
                        🔄 清空表單
                    </button>
                </div>

                <div class="info-box" style="margin-top: 20px;">
                    <p style="color: #00ff99; font-size: 0.9em;">
                        ℹ️ 您的建議將會送達開發團隊,我們會仔細閱讀每一條建議並持續改進系統。感謝您的支持！
                    </p>
                    <p style="color: #a78bfa; font-size: 0.9em; margin-top: 15px; margin-bottom: 10px;">
                        💬 也歡迎加入我們的 Discord 伺服器交流討論：
                    </p>
                    <div style="text-align: center; margin-top: 15px;">
                        <a href="https://discord.gg/typTeSzUQr" target="_blank" rel="noopener noreferrer" 
                           style="display: inline-flex; align-items: center; gap: 10px; 
                                  padding: 12px 30px; background: linear-gradient(135deg, #5865F2 0%, #4752C4 100%); 
                                  color: white; text-decoration: none; border-radius: 8px; 
                                  font-weight: bold; font-size: 1.1em; 
                                  transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(88, 101, 242, 0.3);"
                           onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 6px 25px rgba(88, 101, 242, 0.5)'; this.style.background='linear-gradient(135deg, #6674F4 0%, #5865F2 100%)';"
                           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(88, 101, 242, 0.3)'; this.style.background='linear-gradient(135deg, #5865F2 0%, #4752C4 100%)';">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="white" style="flex-shrink: 0;">
                                <path d="M19.27 5.33C17.94 4.71 16.5 4.26 15 4a.09.09 0 0 0-.07.03c-.18.33-.39.76-.53 1.09a16.09 16.09 0 0 0-4.8 0c-.14-.34-.35-.76-.54-1.09c-.01-.02-.04-.03-.07-.03c-1.5.26-2.93.71-4.27 1.33c-.01 0-.02.01-.03.02c-2.72 4.07-3.47 8.03-3.1 11.95c0 .02.01.04.03.05c1.8 1.32 3.53 2.12 5.24 2.65c.03.01.06 0 .07-.02c.4-.55.76-1.13 1.07-1.74c.02-.04 0-.08-.04-.09c-.57-.22-1.11-.48-1.64-.78c-.04-.02-.04-.08-.01-.11c.11-.08.22-.17.33-.25c.02-.02.05-.02.07-.01c3.44 1.57 7.15 1.57 10.55 0c.02-.01.05-.01.07.01c.11.09.22.17.33.26c.04.03.04.09-.01.11c-.52.31-1.07.56-1.64.78c-.04.01-.05.06-.04.09c.32.61.68 1.19 1.07 1.74c.03.01.06.02.09.01c1.72-.53 3.45-1.33 5.25-2.65c.02-.01.03-.03.03-.05c.44-4.53-.73-8.46-3.1-11.95c-.01-.01-.02-.02-.04-.02zM8.52 14.91c-1.03 0-1.89-.95-1.89-2.12s.84-2.12 1.89-2.12c1.06 0 1.9.96 1.89 2.12c0 1.17-.84 2.12-1.89 2.12zm6.97 0c-1.03 0-1.89-.95-1.89-2.12s.84-2.12 1.89-2.12c1.06 0 1.9.96 1.89 2.12c0 1.17-.83 2.12-1.89 2.12z"/>
                            </svg>
                            <span>加入 Discord 伺服器</span>
                        </a>
                    </div>
                </div>

                <div class="info-box" style="margin-top: 20px; background: rgba(255, 153, 0, 0.1); border-left-color: #ff9900;">
                    <p style="color: #ffb347; font-weight: bold; margin-bottom: 10px;">📚 推薦工具</p>
                    <p style="color: #cbd5e1; font-size: 0.95em; margin-bottom: 15px;">
                        需要查詢 BOSS 或怪物資訊？推薦使用專業的 Artale 楓之谷怪物圖鑑！
                    </p>
                    <div style="text-align: center;">
                        <a href="https://artalemaplestory.com/" target="_blank" rel="noopener noreferrer" 
                           style="display: inline-flex; align-items: center; gap: 10px; 
                                  padding: 12px 30px; background: linear-gradient(135deg, #ff9900 0%, #ff7700 100%); 
                                  color: white; text-decoration: none; border-radius: 8px; 
                                  font-weight: bold; font-size: 1.05em; 
                                  transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(255, 153, 0, 0.3);"
                           onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 6px 25px rgba(255, 153, 0, 0.5)'; this.style.background='linear-gradient(135deg, #ffaa22 0%, #ff9900 100%)';"
                           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(255, 153, 0, 0.3)'; this.style.background='linear-gradient(135deg, #ff9900 0%, #ff7700 100%)';">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="white" style="flex-shrink: 0;">
                                <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
                            </svg>
                            <span>Artale 楓之谷怪物圖鑑</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tesseract.js OCR 庫 -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="discord-notifications.js"></script>

    <script src="data.js"></script>
    <script src="main.js"></script>
</body>
</html>
