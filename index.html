<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¥“ä¹‹è°·BOSSé‡ç”Ÿæ™‚é–“ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #15152b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(21, 21, 43, 0.5);
            border-radius: 15px;
            border: 1px solid rgba(0, 153, 204, 0.3);
        }

        .header h1 {
            color: #0099cc;
            font-size: 2em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(0, 153, 204, 0.3);
        }

        .header p {
            color: #66ddee;
            font-size: 1.1em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(0, 153, 204, 0.3);
            flex-wrap: nowrap;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        .tabs::-webkit-scrollbar {
            height: 4px;
        }

        .tabs::-webkit-scrollbar-thumb {
            background: rgba(0, 153, 204, 0.5);
            border-radius: 2px;
        }

        .tab {
            padding: 12px 24px;
            background: #1e1e3a;
            border: 1px solid rgba(0, 153, 204, 0.3);
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            color: #94a3b8;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .tab:hover {
            background: #2a2a4a;
            color: #cbd5e1;
        }

        .tab.active {
            background: #0099cc;
            color: #0a0a1a;
            font-weight: bold;
        }

        .tab-content {
            display: none;
            background: #15152b;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #00ccff;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            background: rgba(30, 41, 59, 0.6);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid rgba(100, 116, 139, 0.3);
        }

        .section h2 {
            color: #0099cc;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .input-field {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .map-select-wrapper {
            background: rgba(0, 153, 204, 0.1);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid rgba(0, 153, 204, 0.3);
            margin: 15px 0;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .map-select-wrapper label {
            color: #0099cc;
            font-size: 1em;
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
        }

        .map-select-wrapper select {
            width: 100%;
            font-size: 1.05em;
            padding: 12px;
        }

        label {
            color: #a0a0c0;
            font-size: 0.9em;
        }

        select, input[type="text"], input[type="number"] {
            padding: 10px;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(100, 116, 139, 0.4);
            border-radius: 5px;
            color: #e2e8f0;
            font-size: 1em;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #0099cc;
            box-shadow: 0 0 0 2px rgba(0, 153, 204, 0.2);
        }

        .info-box {
            background: rgba(0, 153, 204, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #0099cc;
        }

        .info-box p {
            color: #66ddee;
            margin: 5px 0;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        button {
            padding: 12px 24px;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(100, 116, 139, 0.4);
            border-radius: 5px;
            color: #e2e8f0;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        button:hover {
            background: #0099cc;
            color: #0a0a1a;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 153, 204, 0.3);
            border-color: #0099cc;
        }

        button:active {
            transform: translateY(0);
        }

        button.danger {
            border-color: rgba(239, 68, 68, 0.4);
            color: #fca5a5;
        }

        button.danger:hover {
            background: #ef4444;
            color: #ffffff;
            border-color: #ef4444;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #2a2a4a;
        }

        th {
            background: #0a0a1a;
            color: #00ccff;
            font-weight: bold;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: rgba(0, 204, 255, 0.1);
        }

        .status-waiting {
            color: #a0a0c0;
        }

        .status-possible {
            color: #ff9800;
            font-weight: bold;
        }

        .status-definite {
            color: #ff3366;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .status-display {
            background: #0a0a1a;
            padding: 20px;
            border-radius: 10px;
            max-height: 600px;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
        }

        .boss-status-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%);
            padding: 10px 16px;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 1px solid rgba(100, 116, 139, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .boss-status-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, rgba(0, 153, 204, 0.3) 0%, rgba(102, 221, 238, 0.3) 50%, rgba(0, 153, 204, 0.3) 100%);
            background-size: 200% 100%;
            animation: borderGlow 3s ease infinite;
        }

        .boss-status-card::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--boss-color, #0099cc);
            border-radius: 12px 0 0 12px;
        }

        @keyframes borderGlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .boss-status-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 153, 204, 0.15);
            border-color: rgba(0, 153, 204, 0.4);
        }

        .boss-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: nowrap;
            gap: 20px;
        }

        .boss-info-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 0;
        }

        .boss-info-row {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #cbd5e1;
            font-size: 1em;
            flex-wrap: wrap;
        }

        .boss-info-item {
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .boss-status-badge {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .boss-status-badge.waiting {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }

        .boss-status-badge.possible {
            background: rgba(249, 115, 22, 0.2);
            color: #fb923c;
        }

        .boss-status-badge.confirmed {
            background: rgba(220, 38, 38, 0.2);
            color: #f87171;
        }

        .boss-action-btns {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-shrink: 0;
        }

        .boss-icon-btn {
            width: 36px;
            height: 36px;
            padding: 0;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(100, 116, 139, 0.3);
            border-radius: 6px;
            color: #cbd5e1;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .boss-icon-btn:hover {
            background: rgba(51, 65, 85, 0.8);
            border-color: rgba(100, 116, 139, 0.5);
            transform: translateY(-1px);
        }

        .boss-icon-btn.delete {
            background: rgba(220, 38, 38, 0.1);
            border-color: rgba(220, 38, 38, 0.3);
            color: #fca5a5;
        }

        .boss-icon-btn.delete:hover {
            background: rgba(220, 38, 38, 0.2);
            border-color: rgba(220, 38, 38, 0.5);
        }

        .quick-input-row {
            display: grid;
            grid-template-columns: 2fr 1fr auto;
            gap: 15px;
            align-items: end;
        }

        .quick-input-row .input-field {
            margin: 0;
        }

        .quick-input-row button {
            padding: 12px 32px;
            height: fit-content;
            font-size: 1.05em;
            font-weight: 600;
        }

        .boss-status-card h3 {
            color: #00ccff;
            margin-bottom: 10px;
        }

        .boss-status-card p {
            margin: 5px 0;
            color: #a0a0c0;
        }

        /* BOSS åœ–ç‰‡æ¨£å¼ */
        .boss-image {
            width: 40px;
            height: 40px;
            object-fit: contain;
            flex-shrink: 0;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .boss-select-preview {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 153, 204, 0.1);
            border-radius: 8px;
        }

        .boss-select-preview img {
            width: 60px;
            height: 60px;
            object-fit: contain;
        }

        .stats-card-image {
            width: 45px;
            height: 45px;
            object-fit: contain;
            margin-right: 10px;
        }

        .boss-list-image {
            width: 40px;
            height: 40px;
            object-fit: contain;
            vertical-align: middle;
        }

        /* è¢å¹•æ“·å–æŒ‰éˆ•æ¨£å¼ */
        .capture-btn {
            width: 42px;
            height: 42px;
            padding: 0;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: 1px solid #10b981;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .capture-btn:hover {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }

        .capture-btn:active {
            transform: translateY(0);
        }

        .capture-btn.monitoring {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-color: #ef4444;
            animation: pulse-monitor 2s infinite;
        }

        .capture-btn.monitoring:hover {
            background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
        }

        @keyframes pulse-monitor {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(239, 68, 68, 0); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1e1e3a;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #00ccff;
            max-width: 400px;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        @keyframes slideIn {
            from {
                transform: translateX(500px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            border-color: rgba(16, 185, 129, 0.5);
        }

        .notification.error {
            border-color: rgba(239, 68, 68, 0.5);
        }

        .notification.warning {
            border-color: rgba(245, 158, 11, 0.5);
        }

        .scrollbar::-webkit-scrollbar {
            width: 10px;
        }

        .scrollbar::-webkit-scrollbar-track {
            background: #0a0a1a;
        }

        .scrollbar::-webkit-scrollbar-thumb {
            background: #00ccff;
            border-radius: 5px;
        }

        .scrollbar::-webkit-scrollbar-thumb:hover {
            background: #00ff99;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stats-card {
            background: #1e1e3a;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #00ccff;
            transition: all 0.3s;
        }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0, 204, 255, 0.3);
        }

        .stats-card h3 {
            color: #00ccff;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stats-number {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }

        .stats-label {
            color: #a0a0c0;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .stats-total {
            color: #00ff99;
        }

        .stats-today {
            color: #ff9800;
        }

        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .section {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .section h2 {
                font-size: 1.1em;
                margin-bottom: 15px;
            }
            
            .input-group {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.5em;
            }

            table {
                font-size: 0.8em;
            }

            th, td {
                padding: 6px 8px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .quick-input-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .quick-input-row button {
                width: 100%;
                padding: 12px;
            }
            
            /* éš±è—OCRè¢å¹•ç›£æ§æŒ‰éˆ• */
            .capture-btn {
                display: none !important;
            }
            
            /* é »é“è¼¸å…¥å„ªåŒ– */
            .input-field {
                margin-bottom: 10px;
            }
            
            .input-field input,
            .input-field select {
                padding: 10px;
                font-size: 1em;
            }

            .boss-card-header {
                flex-direction: row;
                align-items: center;
                gap: 10px;
            }

            .boss-info-left {
                width: 100%;
                flex: 1;
            }
            
            .boss-image {
                width: 35px;
                height: 35px;
            }

            .boss-info-row {
                flex-direction: row;
                flex-wrap: wrap;
                align-items: center;
                gap: 6px;
                font-size: 0.85em;
            }
            
            .boss-info-item {
                gap: 4px;
            }
            
            .boss-status-card {
                padding: 8px 12px;
                margin-bottom: 8px;
            }

            .boss-action-btns {
                flex-shrink: 0;
            }
            
            .boss-icon-btn {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }
            
            /* åˆ†é æ¨™ç±¤å„ªåŒ– */
            .tabs {
                gap: 5px;
                margin-bottom: 15px;
            }
            
            .tab {
                padding: 10px 12px;
                font-size: 0.9em;
            }
            
            /* çµ±è¨ˆå¡ç‰‡å„ªåŒ– */
            .stats-card {
                padding: 12px;
            }
            
            .stats-card-image {
                width: 35px;
                height: 35px;
            }
            
            /* é è¦½å€åŸŸå„ªåŒ– */
            #scan-preview {
                padding: 8px;
            }
            
            #scan-preview img {
                max-height: 60px;
            }

            /* å€‹åˆ¥ BOSS Webhook å¡ç‰‡å„ªåŒ– */
            .boss-webhook-card {
                grid-template-columns: 1fr !important;
            }

            .boss-webhook-actions {
                justify-content: flex-start !important;
            }
        }

        /* å€‹åˆ¥ BOSS Webhook å¡ç‰‡æ¨£å¼ */
        .boss-webhook-card {
            background: rgba(30, 41, 59, 0.6);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(100, 116, 139, 0.3);
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 15px;
            align-items: center;
            transition: all 0.3s;
        }

        .boss-webhook-card:hover {
            border-color: rgba(139, 92, 246, 0.5);
            background: rgba(30, 41, 59, 0.8);
        }

        .boss-webhook-info {
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 180px;
        }

        .boss-webhook-input {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .boss-webhook-input input {
            font-family: monospace;
            font-size: 0.9em;
        }

        .boss-webhook-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .boss-webhook-btn {
            padding: 8px 16px;
            font-size: 0.9em;
            white-space: nowrap;
        }

        .webhook-configured {
            border-color: rgba(16, 185, 129, 0.5) !important;
            background: rgba(16, 185, 129, 0.05);
        }

        .webhook-configured::before {
            content: 'âœ…';
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 0.9em;
        }

        .boss-webhook-card {
            position: relative;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="tabs">
            <div class="tab active" onclick="switchTab(0)">BOSSè¨˜éŒ„</div>
            <div class="tab" onclick="switchTab(1)">BOSSåˆ—è¡¨</div>
            <div class="tab" onclick="switchTab(2)">æ“Šæ®ºçµ±è¨ˆ</div>
            <div class="tab" onclick="switchTab(3)">é€šçŸ¥è¨­å®š</div>
            <div class="tab" onclick="switchTab(4)">æ”¹å–„å»ºè­°</div>
        </div>

        <div class="tab-content active" id="tab-record">
            <div class="section">
                <h2>å¿«é€Ÿè¨˜éŒ„ BOSS æ“Šæ®º</h2>
                <div class="quick-input-row">
                    <div class="input-field">
                        <label>é¸æ“‡BOSS:</label>
                        <select id="boss-select" onchange="onBossSelected()">
                            <option value="">è«‹é¸æ“‡...</option>
                        </select>
                    </div>
                    <div class="input-field">
                        <label>é »é“:</label>
                        <div style="display: flex; gap: 8px;">
                            <input type="text" id="channel-input" value="1" maxlength="4" style="flex: 1;" placeholder="é »é“è™Ÿç¢¼">
                            <button type="button" id="monitor-btn" onclick="toggleScreenMonitor()" class="capture-btn" title="é–‹å§‹/åœæ­¢è¢å¹•ç›£æ§">
                                ğŸ¯
                            </button>
                            <button type="button" onclick="adjustScanArea()" class="capture-btn" title="èª¿æ•´æƒæä½ç½®" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border-color: #8b5cf6;">
                                âš™ï¸
                            </button>
                            <button type="button" onclick="previewScanArea()" class="capture-btn" title="é è¦½æƒæå€åŸŸ" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-color: #f59e0b;">
                                ğŸ‘ï¸
                            </button>
                            <button type="button" onclick="showOcrHelp()" class="capture-btn" title="ä½¿ç”¨èªªæ˜" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); border-color: #6b7280;">
                                â“
                            </button>
                        </div>
                        <div id="scan-preview" style="display:none; margin-top:10px; padding:10px; background:#1a1a2e; border-radius:8px;">
                            <div style="color:#888; margin-bottom:5px;">æƒæå€åŸŸé è¦½ï¼š<span id="preview-countdown" style="color:#10b981;"></span></div>
                            <img id="preview-img" style="max-width:100%; border:2px solid #10b981; border-radius:4px;">
                        </div>
                    </div>
                    <button type="button" onclick="recordBoss()" style="background: linear-gradient(135deg, #0099cc 0%, #0077aa 100%); border-color: #0099cc;">
                        ğŸ“ è¨˜éŒ„æ“Šæ®º
                    </button>
                </div>

                <div class="map-select-wrapper" id="map-select-container" style="display: none;">
                    <label>ğŸ—ºï¸ é¸æ“‡åœ°åœ–ä½ç½®:</label>
                    <select id="map-select">
                        <option value="7">å¤œå¸‚å¾’æ­¥å€7</option>
                        <option value="7-1">å¤œå¸‚å¾’æ­¥å€7-1</option>
                    </select>
                </div>

                <div class="info-box" id="boss-info" style="display: none;">
                    <div class="boss-select-preview">
                        <img id="boss-preview-image" src="" alt="BOSSé è¦½" style="display: none;">
                        <div>
                            <p id="map-info"></p>
                            <p id="time-info"></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">ç•¶å‰è¨˜éŒ„ä¸­çš„BOSS (<span id="boss-count">0</span>)</h2>
                    <button type="button" onclick="clearAll()" class="danger" style="margin: 0;">âš ï¸ æ¸…ç©ºæ‰€æœ‰è¨˜éŒ„</button>
                </div>
                <div id="record-container" style="display: grid; gap: 16px;">
                    <!-- å¡ç‰‡å°‡é€šéJavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <div class="tab-content" id="tab-settings">
            <div class="section">
                <h2>BOSSè³‡è¨Šä¸€è¦½</h2>
                <div style="overflow-x: auto;">
                    <table id="boss-list-table">
                        <thead>
                            <tr>
                                <th style="width: 60px;">åœ–ç‰‡</th>
                                <th>BOSSåç¨±</th>
                                <th>é‡ç”Ÿæ™‚é–“ç¯„åœ</th>
                                <th>åœ°åœ–</th>
                            </tr>
                        </thead>
                        <tbody id="boss-list-tbody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-content" id="tab-statistics">
            <div class="section">
                <div class="stats-header">
                    <h2>ğŸ“Š BOSSæ“Šæ®ºçµ±è¨ˆ</h2>
                    <div class="button-group" style="margin: 0;">
                        <button type="button" onclick="resetTodayStats()">ğŸ”„ é‡ç½®ä»Šæ—¥çµ±è¨ˆ</button>
                        <button type="button" onclick="resetAllStats()" class="danger">âš ï¸ æ¸…ç©ºæ‰€æœ‰çµ±è¨ˆ</button>
                    </div>
                </div>
                
                <div class="info-box">
                    <p>ğŸ“… çµ±è¨ˆæ—¥æœŸ: <span id="stats-date"></span></p>
                    <p>ğŸ¯ ä»Šæ—¥ç¸½æ“Šæ®º: <span id="total-today-kills" style="color: #ff9800; font-weight: bold; font-size: 1.2em;">0</span> æ¬¡</p>
                    <p>ğŸ† ç´¯ç©ç¸½æ“Šæ®º: <span id="total-all-kills" style="color: #00ff99; font-weight: bold; font-size: 1.2em;">0</span> æ¬¡</p>
                </div>

                <div class="stats-grid" id="stats-grid">
                    <!-- çµ±è¨ˆå¡ç‰‡å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <div class="tab-content" id="tab-notification">
            <div class="section">
                <h2>ğŸ”” Discord é€šçŸ¥è¨­å®š</h2>
                <p style="color: #a0a0c0; margin-bottom: 20px;">
                    è¨­å®šæ‚¨çš„ Discord Webhookï¼Œå³å¯åœ¨æ“Šæ®ºBOSSæ™‚è‡ªå‹•æ¥æ”¶é€šçŸ¥åˆ°æ‚¨çš„Discordé »é“ï¼
                </p>

                <div class="info-box" style="background: rgba(16, 185, 129, 0.1); border-left-color: #10b981;">
                    <p style="color: #10b981; font-weight: bold; margin-bottom: 10px;">ğŸ“¢ çµ±ä¸€é€šçŸ¥ Webhook</p>
                    <p style="color: #cbd5e1; font-size: 0.95em; margin-bottom: 5px;">
                        æ­¤ Webhook æœƒæ¥æ”¶<strong>æ‰€æœ‰BOSS</strong>çš„æ“Šæ®ºé€šçŸ¥ï¼Œæ–¹ä¾¿é›†ä¸­ç®¡ç†ã€‚
                    </p>
                </div>

                <div class="input-group" style="margin-top: 20px;">
                    <div class="input-field" style="grid-column: 1 / -1;">
                        <label style="font-size: 1.05em; color: #0099cc; font-weight: bold;">
                            ğŸ”— Discord Webhook URL:
                        </label>
                        <input type="text" id="user-webhook-url" 
                               placeholder="https://discord.com/api/webhooks/..."
                               style="width: 100%; font-family: monospace; font-size: 0.9em;">
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" onclick="saveUserWebhook()" 
                            style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-color: #10b981; padding: 15px 30px; font-size: 1.1em;">
                        ğŸ’¾ å„²å­˜è¨­å®š
                    </button>
                    <button type="button" onclick="testUserWebhook()" 
                            style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-color: #f59e0b; padding: 15px 30px; font-size: 1.1em;">
                        ğŸ§ª æ¸¬è©¦é€šçŸ¥
                    </button>
                    <button type="button" onclick="clearUserWebhook()" class="danger"
                            style="padding: 15px 30px; font-size: 1.1em;">
                        ğŸ—‘ï¸ æ¸…é™¤è¨­å®š
                    </button>
                </div>

                <div id="webhook-status" style="display: none; margin-top: 15px;" class="info-box">
                    <p id="webhook-status-text"></p>
                </div>

                <!-- å€‹åˆ¥ BOSS é€šçŸ¥è¨­å®š -->
                <div class="section" style="margin-top: 30px; background: rgba(139, 92, 246, 0.05); border: 1px solid rgba(139, 92, 246, 0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3 style="color: #a78bfa; margin-bottom: 8px;">ğŸ¯ å€‹åˆ¥ BOSS é€šçŸ¥è¨­å®š</h3>
                            <p style="color: #cbd5e1; font-size: 0.9em;">
                                ç‚ºæ¯å€‹ BOSS è¨­å®šå°ˆå±¬çš„ Webhookï¼ˆé¸ç”¨ï¼‰| å·²è¨­å®šï¼š<span id="individual-webhook-count" style="color: #10b981; font-weight: bold;">0</span> / <span id="total-boss-count">0</span>
                            </p>
                        </div>
                        <button type="button" onclick="toggleIndividualWebhooks()" id="toggle-individual-btn"
                                style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border-color: #8b5cf6; padding: 10px 20px;">
                            ğŸ“‚ å±•é–‹è¨­å®š
                        </button>
                    </div>

                    <div id="individual-webhooks-container" style="display: none;">
                        <div class="info-box" style="background: rgba(245, 158, 11, 0.1); border-left-color: #f59e0b; margin-bottom: 20px;">
                            <p style="color: #fbbf24; font-size: 0.95em;">
                                ğŸ’¡ <strong>æç¤ºï¼š</strong>å€‹åˆ¥è¨­å®šæœƒè¦†è“‹çµ±ä¸€é€šçŸ¥ã€‚å¦‚æœæŸå€‹ BOSS æ²’æœ‰è¨­å®šå°ˆå±¬ Webhookï¼Œæœƒè‡ªå‹•ä½¿ç”¨ä¸Šæ–¹çš„çµ±ä¸€é€šçŸ¥ã€‚
                            </p>
                        </div>

                        <div class="button-group" style="margin-bottom: 20px;">
                            <button type="button" onclick="saveAllIndividualWebhooks()" 
                                    style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-color: #10b981;">
                                ğŸ’¾ å„²å­˜æ‰€æœ‰è¨­å®š
                            </button>
                            <button type="button" onclick="clearAllIndividualWebhooks()" class="danger">
                                ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰å€‹åˆ¥è¨­å®š
                            </button>
                        </div>

                        <div id="boss-webhooks-list" style="display: grid; gap: 15px;">
                            <!-- BOSS Webhook è¼¸å…¥æ¡†å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <!-- ä½¿ç”¨æ•™å­¸ -->
                <div class="section" style="margin-top: 30px; background: rgba(139, 92, 246, 0.05); border: 1px solid rgba(139, 92, 246, 0.3);">
                    <h3 style="color: #a78bfa; margin-bottom: 15px;">ğŸ“š ä½¿ç”¨æ•™å­¸</h3>
                    
                    <div style="color: #cbd5e1; line-height: 1.8;">
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #10b981; margin-bottom: 20px;">
                            <p style="color: #34d399; font-weight: bold; margin-bottom: 8px;">ğŸ¯ ä¸‰ç¨®é€šçŸ¥æ–¹å¼èªªæ˜</p>
                            <ul style="margin-left: 20px; color: #6ee7b7;">
                                <li><strong>çµ±ä¸€é€šçŸ¥</strong>ï¼šæ‰€æœ‰ BOSS éƒ½ç™¼é€åˆ°åŒä¸€å€‹é »é“ï¼ˆé©åˆæ‡¶äººã€å€‹äººä½¿ç”¨ï¼‰</li>
                                <li><strong>å€‹åˆ¥é€šçŸ¥</strong>ï¼šæ¯å€‹ BOSS ç™¼é€åˆ°å°ˆå±¬é »é“ï¼ˆé©åˆç²¾ç´°ç®¡ç†ã€åœ˜éšŠåˆ†å·¥ï¼‰</li>
                                <li><strong>æ··åˆä½¿ç”¨</strong>ï¼šå…©ç¨®å¯ä»¥åŒæ™‚è¨­å®šï¼Œäº’ä¸å½±éŸ¿ï¼ˆæœ€å¤§å½ˆæ€§ï¼‰</li>
                            </ul>
                        </div>

                        <p style="font-weight: bold; color: #a78bfa; margin-bottom: 10px;">ğŸ”¹ æ­¥é©Ÿä¸€ï¼šå»ºç«‹ Discord Webhook</p>
                        <ol style="margin-left: 20px; margin-bottom: 20px;">
                            <li>æ‰“é–‹ä½ çš„ Discord ä¼ºæœå™¨</li>
                            <li>åœ¨æƒ³è¦æ¥æ”¶é€šçŸ¥çš„é »é“ä¸Šé»æ“Šã€Œç·¨è¼¯é »é“ã€âš™ï¸</li>
                            <li>é¸æ“‡ã€Œæ•´åˆã€â†’ã€ŒWebhookã€</li>
                            <li>é»æ“Šã€Œå»ºç«‹ Webhookã€æˆ–ã€Œæ–°å¢ Webhookã€</li>
                            <li>è¨­å®š Webhook åç¨±ï¼ˆä¾‹å¦‚ï¼šæ¥“ä¹‹è°·BOSSé€šçŸ¥ï¼‰</li>
                            <li>é»æ“Šã€Œè¤‡è£½ Webhook ç¶²å€ã€ğŸ“‹</li>
                        </ol>

                        <p style="font-weight: bold; color: #a78bfa; margin-bottom: 10px;">ğŸ”¹ æ­¥é©ŸäºŒï¼šé¸æ“‡é€šçŸ¥æ–¹å¼ä¸¦è¨­å®š</p>
                        
                        <div style="background: #0a0a1a; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <p style="color: #10b981; font-weight: bold; margin-bottom: 8px;">ğŸ’š æ¨è–¦ï¼šçµ±ä¸€é€šçŸ¥ï¼ˆé©åˆå¤§å¤šæ•¸äººï¼‰</p>
                            <ol style="margin-left: 20px; color: #6ee7b7;">
                                <li>å°‡ Webhook ç¶²å€è²¼åˆ°ä¸Šæ–¹ã€Œçµ±ä¸€é€šçŸ¥ã€çš„è¼¸å…¥æ¡†</li>
                                <li>é»æ“Šã€ŒğŸ’¾ å„²å­˜è¨­å®šã€</li>
                                <li>é»æ“Šã€ŒğŸ§ª æ¸¬è©¦é€šçŸ¥ã€ç¢ºèª</li>
                            </ol>
                            <p style="color: #34d399; margin-top: 8px; font-size: 0.9em;">âœ¨ é€™æ¨£æ‰€æœ‰ BOSS çš„é€šçŸ¥éƒ½æœƒç™¼é€åˆ°é€™å€‹é »é“ï¼</p>
                        </div>

                        <div style="background: #0a0a1a; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <p style="color: #a78bfa; font-weight: bold; margin-bottom: 8px;">ğŸ’œ é€²éšï¼šå€‹åˆ¥é€šçŸ¥ï¼ˆéœ€è¦ç²¾ç´°ç®¡ç†ï¼‰</p>
                            <ol style="margin-left: 20px; color: #c4b5fd;">
                                <li>é»æ“Šã€ŒğŸ“‚ å±•é–‹è¨­å®šã€æŒ‰éˆ•</li>
                                <li>ç‚ºéœ€è¦çš„ BOSS å–®ç¨è²¼ä¸Š Webhook ç¶²å€</li>
                                <li>é»æ“Šã€ŒğŸ’¾ å„²å­˜æ‰€æœ‰è¨­å®šã€</li>
                                <li>å¯ä»¥å–®ç¨æ¸¬è©¦æ¯å€‹ BOSS çš„é€šçŸ¥</li>
                            </ol>
                            <p style="color: #a78bfa; margin-top: 8px; font-size: 0.9em;">âœ¨ æœ‰è¨­å®šå€‹åˆ¥çš„å°±ç™¼é€åˆ°å€‹åˆ¥é »é“ï¼Œæ²’è¨­å®šçš„æœƒç”¨çµ±ä¸€é€šçŸ¥ï¼</p>
                        </div>

                        <p style="font-weight: bold; color: #a78bfa; margin-bottom: 10px;">ğŸ”¹ Webhook ç¶²å€æ ¼å¼ç¯„ä¾‹ï¼š</p>
                        <div style="background: #0a0a1a; padding: 12px; border-radius: 5px; font-family: monospace; font-size: 0.85em; margin-bottom: 20px; overflow-x: auto;">
                            https://discord.com/api/webhooks/1234567890123456789/AbCdEfGhIjKlMnOpQrStUvWxYz1234567890
                        </div>

                        <p style="font-weight: bold; color: #a78bfa; margin-bottom: 10px;">ğŸ”¹ é€šçŸ¥ç™¼é€é‚è¼¯ï¼š</p>
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <p style="color: #60a5fa; margin-bottom: 10px;">ç•¶ä½ è¨˜éŒ„ BOSS æ“Šæ®ºæ™‚ï¼Œç³»çµ±æœƒï¼š</p>
                            <ol style="margin-left: 20px; color: #93c5fd;">
                                <li>å¦‚æœæœ‰è¨­å®šè©² BOSS çš„<strong>å€‹åˆ¥ Webhook</strong> â†’ ç™¼é€åˆ°å€‹åˆ¥é »é“</li>
                                <li>å¦‚æœæœ‰è¨­å®š<strong>çµ±ä¸€ Webhook</strong> â†’ ä¹Ÿç™¼é€åˆ°çµ±ä¸€é »é“</li>
                                <li>å…©ç¨®å¯ä»¥åŒæ™‚æ¥æ”¶ï¼ˆäº’ä¸å½±éŸ¿ï¼‰</li>
                            </ol>
                        </div>

                        <p style="font-weight: bold; color: #a78bfa; margin-bottom: 10px;">ğŸ”¹ é€šçŸ¥å…§å®¹èªªæ˜ï¼š</p>
                        <ul style="margin-left: 20px; margin-bottom: 20px;">
                            <li>âœ… æ¯æ¬¡è¨˜éŒ„ BOSS æ“Šæ®ºæ™‚è‡ªå‹•ç™¼é€é€šçŸ¥</li>
                            <li>âœ… é¡¯ç¤º BOSS åç¨±ã€é »é“ã€åœ°åœ–ä½ç½®</li>
                            <li>âœ… é¡¯ç¤ºé è¨ˆé‡ç”Ÿæ™‚é–“ç¯„åœ</li>
                            <li>âœ… ä½¿ç”¨ BOSS å°ˆå±¬é¡è‰²çš„è¨Šæ¯åµŒå…¥</li>
                        </ul>

                        <div style="background: rgba(245, 158, 11, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #f59e0b; margin-top: 20px;">
                            <p style="color: #fbbf24; font-weight: bold; margin-bottom: 8px;">âš ï¸ æ³¨æ„äº‹é …ï¼š</p>
                            <ul style="margin-left: 20px; color: #fcd34d;">
                                <li>è«‹å‹¿å°‡ Webhook ç¶²å€åˆ†äº«çµ¦ä»–äºº</li>
                                <li>Webhook è¨­å®šåƒ…å„²å­˜åœ¨ä½ çš„ç€è¦½å™¨ä¸­</li>
                                <li>æ¸…é™¤ç€è¦½å™¨è³‡æ–™æœƒåŒæ™‚æ¸…é™¤ Webhook è¨­å®š</li>
                                <li>å€‹åˆ¥è¨­å®šæœƒè¦†è“‹çµ±ä¸€é€šçŸ¥ï¼ˆä½†å…©å€‹éƒ½æœƒç™¼é€ï¼Œå¦‚æœéƒ½æœ‰è¨­å®šï¼‰</li>
                            </ul>
                        </div>

                        <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #10b981; margin-top: 15px;">
                            <p style="color: #34d399; font-weight: bold; margin-bottom: 8px;">ğŸ’¡ ä½¿ç”¨å»ºè­°ï¼š</p>
                            <ul style="margin-left: 20px; color: #6ee7b7;">
                                <li><strong>å€‹äººç©å®¶</strong>ï¼šåªè¨­å®šçµ±ä¸€é€šçŸ¥å³å¯</li>
                                <li><strong>åœ˜éšŠåˆä½œ</strong>ï¼šè¨­å®šçµ±ä¸€é€šçŸ¥åˆ°åœ˜éšŠé »é“</li>
                                <li><strong>ç²¾ç´°ç®¡ç†</strong>ï¼šé‡è¦ BOSS è¨­å®šå€‹åˆ¥é€šçŸ¥ï¼Œå…¶ä»–ç”¨çµ±ä¸€</li>
                                <li><strong>å¤šé‡é€šçŸ¥</strong>ï¼šå…©ç¨®éƒ½è¨­å®šï¼Œç¢ºä¿ä¸æœƒéŒ¯éä»»ä½•é€šçŸ¥</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="tab-feedback">
            <div class="section">
                <h2>ğŸ’¡ æ”¹å–„å»ºè­°</h2>
                <p style="color: #a0a0c0; margin-bottom: 20px;">
                    å¦‚æœæ‚¨åœ¨ä½¿ç”¨éç¨‹ä¸­æœ‰ä»»ä½•æ”¹å–„å»ºè­°æˆ–ç™¼ç¾å•é¡Œï¼Œæ­¡è¿é€éä¸‹æ–¹è¡¨å–®å‘Šè¨´æˆ‘å€‘ï¼
                </p>
                
                <div class="input-group">
                    <div class="input-field" style="grid-column: 1 / -1;">
                        <label>å»ºè­°é¡å‹:</label>
                        <select id="feedback-type" style="width: 100%;">
                            <option value="åŠŸèƒ½å»ºè­°">åŠŸèƒ½å»ºè­°</option>
                            <option value="éŒ¯èª¤å›å ±">éŒ¯èª¤å›å ±</option>
                            <option value="UI/UXæ”¹å–„">UI/UXæ”¹å–„</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                </div>

                <div class="input-group">
                    <div class="input-field" style="grid-column: 1 / -1;">
                        <label>è©³ç´°èªªæ˜:</label>
                        <textarea id="feedback-content" 
                                  style="width: 100%; min-height: 150px; padding: 10px; 
                                         background: #0a0a1a; border: 1px solid #00ccff; 
                                         border-radius: 5px; color: #ffffff; font-family: inherit; 
                                         font-size: 1em; resize: vertical;"
                                  placeholder="è«‹è©³ç´°æè¿°æ‚¨çš„å»ºè­°æˆ–å•é¡Œ..."></textarea>
                    </div>
                </div>

                <div class="input-group">
                    <div class="input-field">
                        <label>è¯çµ¡æ–¹å¼ (é¸å¡«):</label>
                        <input type="text" id="feedback-contact" 
                               placeholder="Emailã€éŠæˆ²ID æˆ–å…¶ä»–è¯çµ¡æ–¹å¼"
                               style="width: 100%;">
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" onclick="submitFeedback()" style="padding: 15px 30px; font-size: 1.1em;">
                        ğŸ“¨ æäº¤å»ºè­°
                    </button>
                    <button type="button" onclick="clearFeedbackForm()" class="danger">
                        ğŸ”„ æ¸…ç©ºè¡¨å–®
                    </button>
                </div>

                <div class="info-box" style="margin-top: 20px;">
                    <p style="color: #00ff99; font-size: 0.9em;">
                        â„¹ï¸ æ‚¨çš„å»ºè­°å°‡æœƒé€é”é–‹ç™¼åœ˜éšŠï¼Œæˆ‘å€‘æœƒä»”ç´°é–±è®€æ¯ä¸€æ¢å»ºè­°ä¸¦æŒçºŒæ”¹é€²ç³»çµ±ã€‚æ„Ÿè¬æ‚¨çš„æ”¯æŒï¼
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Tesseract.js OCR åº« -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="discord-notifications.js"></script>
    <script>
        // BOSS æ•¸æ“š
        const BOSS_DATA = {
            "ç´…å¯¶ç‹": { min: 23, max: 30, maps: ["æµ·å²¸è‰å¢3"], color: "#ff4444", image: "images/ç´…å¯¶ç‹.gif" },
            "æ¨¹å¦–ç‹": { min: 23, max: 30, maps: ["æ±æ–¹å²©çŸ³å±±5"], color: "#8bc34a", image: "images/æ¨¹å¦–ç‹.gif" },
            "å†¥ç•Œå¹½éˆ": { min: 45, max: 60, maps: ["1è™Ÿç·š<4å€>", "2è™Ÿç·š<3å€>"], color: "#9c27b0", image: "images/å†¥ç•Œå¹½éˆ.gif" },
            "å·¨å±…èŸ¹": { min: 45, max: 60, maps: ["æµ·é¾œæ²™ç˜"], color: "#ff9800", image: "images/å·¨å±…èŸ¹.gif" },
            "æ®­å±çŒ´ç‹": { min: 38, max: 45, maps: ["å·«å©†æ£®æ—1"], color: "#795548", image: "images/æ®­å±çŒ´ç‹.gif" },
            "è˜‘è‡ç‹": { min: 210, max: 240, maps: ["é‹¼ä¹‹è‚¥è‚¥å…¬åœ’3"], color: "#ff5722", image: "images/è˜‘è‡ç‹.gif" },
            "æ²¼æ¾¤å·¨é±·": { min: 90, max: 105, maps: ["å±éšªçš„é»‘é±·é­š1"], color: "#4caf50", image: "images/æ²¼æ¾¤å·¨é±·.gif" },
            "æ®­å±è˜‘è‡ç‹": { min: 195, max: 225, maps: ["è˜‘è‡ç‹ä¹‹å¢“"], color: "#e91e63", image: "images/æ®­å±è˜‘è‡ç‹.gif" },
            "å·´æ´›å¤": { min: 405, max: 540, maps: ["å—è©›å’’çš„ç¥æ®¿"], color: "#ff0000", image: "images/å·´æ´›å¤.gif" },
            "è‰¾åˆ©å‚‘": { min: 118, max: 128, maps: ["å¤©ç©ºéšæ¢¯2"], color: "#00bcd4", image: "images/è‰¾åˆ©å‚‘.gif" },
            "é›ªå±±å¥³å·«": { min: 158, max: 180, maps: ["å†°é¢1"], color: "#87ceeb", image: "images/é›ªå±±å¥³å·«.gif" },
            "é›ªæ¯›æ€ªäºº": { min: 45, max: 68, maps: ["é›ªäººä¹‹è°·"], color: "#f0f8ff", image: "images/é›ªæ¯›æ€ªäºº.gif" },
            "å„é‹æ­»ç¥": { min: 45, max: 105, maps: ["æ­»äº¡æ£®æ—4"], color: "#2f4f4f", image: "images/å„é‹æ­»ç¥.gif" },
            "å’•å’•é˜": { min: 68, max: 90, maps: ["æ™‚é–“ä¹‹è·¯<3>"], color: "#daa520", image: "images/å’•å’•é˜.gif" },
            "è‘›é›·é‡‘å‰›": { min: 270, max: 350, maps: ["è‘›é›·è‰åŸ"], color: "#8b4513", image: "images/è‘›é›·é‡‘å‰›.gif" },
            "æ›¸ç”Ÿå¹½éˆ": { min: 150, max: 300, maps: ["ç‹ç‹¸è°·"], color: "#9370db", image: "images/æ›¸ç”Ÿå¹½éˆ.gif" },
            "ä¹å°¾å¦–ç‹": { min: 210, max: 570, maps: ["æœˆäº®å±±å¡"], color: "#ff69b4", image: "images/ä¹å°¾å¦–ç‹.gif" },
            "é»‘è¼ªç‹": { min: 780, max: 1020, maps: ["å¤œå¸‚å¾’æ­¥å€7", "å¤œå¸‚å¾’æ­¥å€7-1"], color: "#000000", hasMapSelect: true, image: "images/é»‘è¼ªç‹.gif" },
            "ç˜‹ç‹‚å–µzå®¢": { min: 120, max: 420, maps: ["åäººå¤§é“è¥¿éƒ¨å€åŸŸ"], color: "#ffa500", image: "images/ç˜‹ç‹‚å–µzå®¢.gif" },
            "ä»™äººå¨ƒå¨ƒ": { min: 158, max: 180, maps: ["ä¸Šç´šè¨“ç·´å ´"], color: "#98fb98", image: "images/ä»™äººå¨ƒå¨ƒ.gif" },
            "è‚¯å¾·ç†Š": { min: 113, max: 128, maps: ["æµæµªç†Šçš„é ˜åœŸ"], color: "#8b7355", image: "images/è‚¯å¾·ç†Š.gif" },
            "å–µæ€ªä»™äºº": { min: 150, max: 170, maps: ["å–µæ€ªä»™äººçš„é ˜åŸŸ"], color: "#ffb6c1", image: "images/å–µæ€ªä»™äºº.gif" },
            "å·¨å¤§æ·±å±±äººè”˜": { min: 60, max: 135, maps: ["è±é¥’çš„è—¥è‰ç”°"], color: "#ffd700", image: "images/å·¨å¤§æ·±å±±äººè”˜.gif" },
            "æµ·æ€’æ–¯": { min: 180, max: 300, maps: ["æµ·æ€’æ–¯æ´ç©´"], color: "#1e90ff", image: "images/æµ·æ€’æ–¯.gif" }
        };

        // å­˜å„²æ•¸æ“š
        let activeBosses = [];
        let patrolRecords = [];
        let bossStatistics = {};

        // åˆå§‹åŒ–
        function init() {
            loadData();
            populateBossSelect();
            populateBossListTable();
            initializeStatistics();
            updateAllDisplays();
            setInterval(updateAllDisplays, 1000);
            loadUserWebhook(); // è¼‰å…¥ç”¨æˆ¶ Webhook è¨­å®š
            
            // åˆå§‹åŒ–å€‹åˆ¥ BOSS Webhook è¨ˆæ•¸
            const individualWebhooks = loadIndividualWebhooks();
            const configuredCount = Object.keys(individualWebhooks).length;
            const totalCount = Object.keys(BOSS_DATA).length;
            document.getElementById('individual-webhook-count').textContent = configuredCount;
            document.getElementById('total-boss-count').textContent = totalCount;

            document.getElementById('channel-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    recordBoss();
                }
            });
        }

        // è¢å¹•ç›£æ§ç›¸é—œè®Šæ•¸
        let screenStream = null;
        let monitorInterval = null;
        let isMonitoring = false;
        let videoElement = null;

        // æƒæå€åŸŸè¨­å®šï¼ˆç™¾åˆ†æ¯”ï¼‰
        let scanArea = {
            x: 28,
            y: 18,
            width: 15,
            height: 6
        };
        
        const savedScanArea = localStorage.getItem('scanArea');
        if (savedScanArea) {
            scanArea = JSON.parse(savedScanArea);
        }
        
        // èª¿æ•´æƒæä½ç½®
        function adjustScanArea() {
            const input = prompt(
                'è«‹è¼¸å…¥æƒæå€åŸŸï¼ˆæ ¼å¼ï¼šX%, Y%, å¯¬%, é«˜%ï¼‰\n' +
                'ç›®å‰è¨­å®šï¼š' + scanArea.x + ', ' + scanArea.y + ', ' + scanArea.width + ', ' + scanArea.height + '\n\n' +
                'æç¤ºï¼šX=å·¦é‚Šè·é›¢, Y=ä¸Šé‚Šè·é›¢\n' +
                'ä¾‹å¦‚ï¼š30, 20, 15, 6',
                scanArea.x + ', ' + scanArea.y + ', ' + scanArea.width + ', ' + scanArea.height
            );
            
            if (input) {
                const parts = input.split(',').map(s => parseFloat(s.trim()));
                if (parts.length === 4 && parts.every(n => !isNaN(n) && n >= 0 && n <= 100)) {
                    scanArea = {
                        x: parts[0],
                        y: parts[1],
                        width: parts[2],
                        height: parts[3]
                    };
                    localStorage.setItem('scanArea', JSON.stringify(scanArea));
                    showNotification('æƒæå€åŸŸå·²æ›´æ–°ï¼', 'success');
                } else {
                    showNotification('æ ¼å¼éŒ¯èª¤ï¼Œè«‹è¼¸å…¥4å€‹0-100çš„æ•¸å­—', 'error');
                }
            }
        }
        
        // é è¦½æƒæå€åŸŸ
        let previewTimer = null;
        async function previewScanArea() {
            try {
                const stream = await navigator.mediaDevices.getDisplayMedia({
                    video: { mediaSource: 'screen' }
                });
                
                const video = document.createElement('video');
                video.srcObject = stream;
                video.muted = true;
                await video.play();
                await new Promise(r => setTimeout(r, 300));
                
                const fullWidth = video.videoWidth;
                const fullHeight = video.videoHeight;
                
                const startX = Math.floor(fullWidth * scanArea.x / 100);
                const startY = Math.floor(fullHeight * scanArea.y / 100);
                const cropWidth = Math.floor(fullWidth * scanArea.width / 100);
                const cropHeight = Math.floor(fullHeight * scanArea.height / 100);
                
                const canvas = document.createElement('canvas');
                canvas.width = cropWidth;
                canvas.height = cropHeight;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, startX, startY, cropWidth, cropHeight, 0, 0, cropWidth, cropHeight);
                
                stream.getTracks().forEach(t => t.stop());
                
                const previewDiv = document.getElementById('scan-preview');
                const previewImg = document.getElementById('preview-img');
                const countdown = document.getElementById('preview-countdown');
                previewImg.src = canvas.toDataURL('image/png');
                previewDiv.style.display = 'block';
                
                let seconds = 10;
                countdown.textContent = `(${seconds}ç§’å¾Œè‡ªå‹•é—œé–‰)`;
                
                if (previewTimer) clearInterval(previewTimer);
                previewTimer = setInterval(() => {
                    seconds--;
                    countdown.textContent = `(${seconds}ç§’å¾Œè‡ªå‹•é—œé–‰)`;
                    if (seconds <= 0) {
                        clearInterval(previewTimer);
                        previewDiv.style.display = 'none';
                    }
                }, 1000);
                
            } catch (error) {
                console.error('é è¦½å¤±æ•—:', error);
            }
        }
        
        // ä½¿ç”¨èªªæ˜
        function showOcrHelp() {
            const helpText = `
ã€è¢å¹•ç›£æ§ OCR ä½¿ç”¨èªªæ˜ã€‘

ğŸ“Œ åŠŸèƒ½èªªæ˜ï¼š
è‡ªå‹•è¾¨è­˜éŠæˆ²ä¸­ã€Œé¸æ“‡é »é“ã€è¦–çª—çš„é »é“è™Ÿç¢¼

ğŸ“Œ ä½¿ç”¨æ­¥é©Ÿï¼š
1ï¸âƒ£ åœ¨éŠæˆ²ä¸­æ‰“é–‹ã€Œé¸æ“‡é »é“ã€è¦–çª—
2ï¸âƒ£ é»æ“Š ğŸ‘ï¸ é è¦½ï¼Œé¸æ“‡éŠæˆ²è¦–çª—
3ï¸âƒ£ ç¢ºèªé è¦½åœ–ç‰‡åªæœ‰ã€Œé »é“ XXXXã€å€åŸŸ
4ï¸âƒ£ å¦‚æœä½ç½®ä¸å°ï¼Œé» âš™ï¸ èª¿æ•´æƒæä½ç½®
5ï¸âƒ£ é»æ“Š ğŸ¯ é–‹å§‹ç›£æ§
6ï¸âƒ£ å†æ¬¡é»æ“Š ğŸ¯ åœæ­¢ç›£æ§

ğŸ“Œ æŒ‰éˆ•èªªæ˜ï¼š
ğŸ¯ é–‹å§‹/åœæ­¢ç›£æ§ï¼ˆç¶ è‰²=å¾…æ©Ÿï¼Œç´…è‰²=ç›£æ§ä¸­ï¼‰
âš™ï¸ èª¿æ•´æƒæä½ç½®ï¼ˆè¼¸å…¥ X%, Y%, å¯¬%, é«˜%ï¼‰
ğŸ‘ï¸ é è¦½æƒæå€åŸŸï¼ˆç¢ºèªä½ç½®æ˜¯å¦æ­£ç¢ºï¼‰
â“ é¡¯ç¤ºæ­¤èªªæ˜

ğŸ“Œ èª¿æ•´ä½ç½®æç¤ºï¼š
â€¢ X = å¾å·¦é‚Šç®—èµ·çš„è·é›¢ç™¾åˆ†æ¯”
â€¢ Y = å¾ä¸Šé¢ç®—èµ·çš„è·é›¢ç™¾åˆ†æ¯”
â€¢ æ•¸å­—è¶Šå¤§ = è¶Šå¾€å³/ä¸‹ç§»å‹•

ğŸ“Œ æ³¨æ„äº‹é …ï¼š
â€¢ ç›£æ§æ™‚è«‹ä¿æŒã€Œé¸æ“‡é »é“ã€è¦–çª—é–‹å•Ÿ
â€¢ é »é“æ”¹è®Šæ™‚è¼¸å…¥æ¡†æœƒé–ƒç¶ å…‰
â€¢ è¨­å®šæœƒè‡ªå‹•å„²å­˜ï¼Œä¸‹æ¬¡ä¸ç”¨é‡æ–°è¨­å®š
            `.trim();
            
            alert(helpText);
        }

        // åˆ‡æ›è¢å¹•ç›£æ§
        async function toggleScreenMonitor() {
            if (isMonitoring) {
                stopScreenMonitor();
            } else {
                await startScreenMonitor();
            }
        }

        // é–‹å§‹è¢å¹•ç›£æ§
        async function startScreenMonitor() {
            const monitorBtn = document.getElementById('monitor-btn');
            
            try {
                monitorBtn.innerHTML = 'â³';
                
                screenStream = await navigator.mediaDevices.getDisplayMedia({
                    video: {
                        mediaSource: 'screen',
                        frameRate: { ideal: 1, max: 5 }
                    }
                });
                
                videoElement = document.createElement('video');
                videoElement.srcObject = screenStream;
                videoElement.muted = true;
                await videoElement.play();
                
                await new Promise(resolve => setTimeout(resolve, 500));
                
                screenStream.getVideoTracks()[0].addEventListener('ended', () => {
                    stopScreenMonitor();
                });
                
                isMonitoring = true;
                monitorBtn.innerHTML = 'ğŸ”´';
                monitorBtn.classList.add('monitoring');
                
                await captureAndRecognize();
                monitorInterval = setInterval(captureAndRecognize, 1000);
                
                showNotification('è¢å¹•ç›£æ§å·²é–‹å§‹', 'success');
                
            } catch (error) {
                console.error('ç„¡æ³•é–‹å§‹ç›£æ§:', error);
                monitorBtn.innerHTML = 'ğŸ¯';
            }
        }

        // åœæ­¢è¢å¹•ç›£æ§
        function stopScreenMonitor() {
            const monitorBtn = document.getElementById('monitor-btn');
            
            isMonitoring = false;
            
            if (monitorInterval) {
                clearInterval(monitorInterval);
                monitorInterval = null;
            }
            
            if (screenStream) {
                screenStream.getTracks().forEach(track => track.stop());
                screenStream = null;
            }
            
            if (videoElement) {
                videoElement.srcObject = null;
                videoElement = null;
            }
            
            monitorBtn.innerHTML = 'ğŸ¯';
            monitorBtn.classList.remove('monitoring');
            
            showNotification('è¢å¹•ç›£æ§å·²åœæ­¢', 'success');
        }

        // æ“·å–ä¸¦è¾¨è­˜
        async function captureAndRecognize() {
            if (!isMonitoring || !videoElement) return;
            
            try {
                const fullWidth = videoElement.videoWidth;
                const fullHeight = videoElement.videoHeight;
                
                const startX = Math.floor(fullWidth * scanArea.x / 100);
                const startY = Math.floor(fullHeight * scanArea.y / 100);
                const cropWidth = Math.floor(fullWidth * scanArea.width / 100);
                const cropHeight = Math.floor(fullHeight * scanArea.height / 100);
                
                if (cropWidth < 10 || cropHeight < 10) return;
                
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = cropWidth;
                tempCanvas.height = cropHeight;
                const tempCtx = tempCanvas.getContext('2d');
                tempCtx.drawImage(videoElement, startX, startY, cropWidth, cropHeight, 0, 0, cropWidth, cropHeight);
                
                const scale = 2;
                const canvas = document.createElement('canvas');
                canvas.width = cropWidth * scale;
                canvas.height = cropHeight * scale;
                const ctx = canvas.getContext('2d');
                ctx.imageSmoothingEnabled = false;
                ctx.drawImage(tempCanvas, 0, 0, canvas.width, canvas.height);
                
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                for (let i = 0; i < data.length; i += 4) {
                    const r = data[i];
                    const g = data[i+1];
                    const b = data[i+2];
                    
                    if (r > 200 && g > 200 && b > 200) {
                        data[i] = data[i+1] = data[i+2] = 0;
                    } else {
                        data[i] = data[i+1] = data[i+2] = 255;
                    }
                }
                ctx.putImageData(imageData, 0, 0);
                
                const result = await Tesseract.recognize(
                    canvas.toDataURL('image/png'),
                    'eng',
                    { tessedit_char_whitelist: '0123456789' }
                );
                
                const text = result.data.text.trim();
                const match = text.match(/(\d{1,4})/);
                if (match) {
                    const channelNumber = match[1];
                    const channelInput = document.getElementById('channel-input');
                    if (channelInput.value !== channelNumber) {
                        channelInput.value = channelNumber;
                        channelInput.style.background = 'rgba(16, 185, 129, 0.3)';
                        setTimeout(() => { channelInput.style.background = ''; }, 300);
                    }
                }
                
            } catch (error) {
                console.error('è¾¨è­˜éŒ¯èª¤:', error);
            }
        }

        // åˆå§‹åŒ–çµ±è¨ˆæ•¸æ“š
        function initializeStatistics() {
            Object.keys(BOSS_DATA).forEach(bossName => {
                if (!bossStatistics[bossName]) {
                    bossStatistics[bossName] = {
                        totalKills: 0,
                        todayKills: 0,
                        lastResetDate: getTodayDateString()
                    };
                }
            });
        }

        // ç²å–ä»Šå¤©çš„æ—¥æœŸå­—ä¸²
        function getTodayDateString() {
            const now = new Date();
            return now.toISOString().split('T')[0];
        }

        // æª¢æŸ¥ä¸¦é‡ç½®æ¯æ—¥çµ±è¨ˆ
        function checkAndResetDailyStats() {
            const today = getTodayDateString();
            let needsReset = false;

            Object.keys(bossStatistics).forEach(bossName => {
                if (bossStatistics[bossName].lastResetDate !== today) {
                    bossStatistics[bossName].todayKills = 0;
                    bossStatistics[bossName].lastResetDate = today;
                    needsReset = true;
                }
            });

            if (needsReset) {
                saveData();
            }
        }

        // æ›´æ–°BOSSçµ±è¨ˆ
        function updateBossStatistics(bossName) {
            if (!bossStatistics[bossName]) {
                bossStatistics[bossName] = {
                    totalKills: 0,
                    todayKills: 0,
                    lastResetDate: getTodayDateString()
                };
            }

            const today = getTodayDateString();
            if (bossStatistics[bossName].lastResetDate !== today) {
                bossStatistics[bossName].todayKills = 0;
                bossStatistics[bossName].lastResetDate = today;
            }

            bossStatistics[bossName].totalKills++;
            bossStatistics[bossName].todayKills++;
            
            saveData();
        }

        // æ›´æ–°çµ±è¨ˆé¡¯ç¤º
        function updateStatisticsDisplay() {
            const statsGrid = document.getElementById('stats-grid');
            const today = getTodayDateString();
            
            document.getElementById('stats-date').textContent = new Date().toLocaleDateString('zh-TW');
            
            let totalToday = 0;
            let totalAll = 0;

            let html = '';
            Object.entries(BOSS_DATA).forEach(([bossName, info]) => {
                const stats = bossStatistics[bossName] || { totalKills: 0, todayKills: 0 };
                
                totalToday += stats.todayKills;
                totalAll += stats.totalKills;

                const bossImageHtml = info.image ? `<img src="${info.image}" alt="${bossName}" class="stats-card-image">` : `<span style="color: ${info.color}">â—</span>`;

                html += `
                    <div class="stats-card">
                        <h3 style="display: flex; align-items: center;">
                            ${bossImageHtml}
                            ${bossName}
                        </h3>
                        <div>
                            <p class="stats-label">ä»Šæ—¥æ“Šæ®º</p>
                            <p class="stats-number stats-today">${stats.todayKills}</p>
                        </div>
                        <div>
                            <p class="stats-label">ç´¯ç©æ“Šæ®º</p>
                            <p class="stats-number stats-total">${stats.totalKills}</p>
                        </div>
                    </div>
                `;
            });

            statsGrid.innerHTML = html;
            
            document.getElementById('total-today-kills').textContent = totalToday;
            document.getElementById('total-all-kills').textContent = totalAll;
        }

        // é‡ç½®ä»Šæ—¥çµ±è¨ˆ
        function resetTodayStats() {
            if (confirm('ç¢ºå®šè¦é‡ç½®ä»Šæ—¥æ‰€æœ‰BOSSçš„æ“Šæ®ºçµ±è¨ˆå—ï¼Ÿ')) {
                const today = getTodayDateString();
                Object.keys(bossStatistics).forEach(bossName => {
                    bossStatistics[bossName].todayKills = 0;
                    bossStatistics[bossName].lastResetDate = today;
                });
                saveData();
                updateStatisticsDisplay();
                showNotification('å·²é‡ç½®ä»Šæ—¥çµ±è¨ˆ', 'success');
            }
        }

        // é‡ç½®æ‰€æœ‰çµ±è¨ˆ
        function resetAllStats() {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰BOSSçš„æ“Šæ®ºçµ±è¨ˆå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                const today = getTodayDateString();
                Object.keys(bossStatistics).forEach(bossName => {
                    bossStatistics[bossName].totalKills = 0;
                    bossStatistics[bossName].todayKills = 0;
                    bossStatistics[bossName].lastResetDate = today;
                });
                saveData();
                updateStatisticsDisplay();
                showNotification('å·²æ¸…ç©ºæ‰€æœ‰çµ±è¨ˆæ•¸æ“š', 'success');
            }
        }

        // å¡«å……BOSSé¸æ“‡åˆ—è¡¨
        function populateBossSelect() {
            const select = document.getElementById('boss-select');
            Object.keys(BOSS_DATA).forEach(boss => {
                const option = document.createElement('option');
                option.value = boss;
                option.textContent = boss;
                select.appendChild(option);
            });
        }

        // å¡«å……BOSSåˆ—è¡¨è¡¨æ ¼
        function populateBossListTable() {
            const tbody = document.getElementById('boss-list-tbody');
            tbody.innerHTML = '';
            Object.entries(BOSS_DATA).forEach(([name, info]) => {
                const row = tbody.insertRow();
                
                const imgCell = row.insertCell(0);
                if (info.image) {
                    imgCell.innerHTML = `<img src="${info.image}" alt="${name}" class="boss-list-image">`;
                }
                
                row.insertCell(1).textContent = name;
                row.insertCell(2).textContent = formatTimeRange(info.min, info.max);
                row.insertCell(3).textContent = info.maps.join(', ');
            });
        }

        // æ ¼å¼åŒ–æ™‚é–“ç¯„åœ
        function formatTimeRange(min, max) {
            const minHour = Math.floor(min/60);
            const minMin = min%60;
            const maxHour = Math.floor(max/60);
            const maxMin = max%60;
            
            let minStr = minHour > 0 ? (minMin > 0 ? `${minHour}å°æ™‚${minMin}åˆ†` : `${minHour}å°æ™‚`) : `${minMin}åˆ†`;
            let maxStr = maxHour > 0 ? (maxMin > 0 ? `${maxHour}å°æ™‚${maxMin}åˆ†` : `${maxHour}å°æ™‚`) : `${maxMin}åˆ†`;
            
            return `${minStr} ~ ${maxStr}`;
        }

        // BOSSè³‡è¨Šå¡ç‰‡è‡ªå‹•é—œé–‰è¨ˆæ™‚å™¨
        let bossInfoTimer = null;

        // BOSSé¸æ“‡äº‹ä»¶
        function onBossSelected() {
            const bossName = document.getElementById('boss-select').value;
            const mapSelectContainer = document.getElementById('map-select-container');
            const previewImage = document.getElementById('boss-preview-image');
            const bossInfoCard = document.getElementById('boss-info');
            
            if (bossInfoTimer) {
                clearTimeout(bossInfoTimer);
                bossInfoTimer = null;
            }
            
            if (bossName && BOSS_DATA[bossName]) {
                const info = BOSS_DATA[bossName];
                
                if (info.hasMapSelect) {
                    mapSelectContainer.style.display = 'block';
                } else {
                    mapSelectContainer.style.display = 'none';
                }
                
                if (info.image) {
                    previewImage.src = info.image;
                    previewImage.alt = bossName;
                    previewImage.style.display = 'block';
                } else {
                    previewImage.style.display = 'none';
                }
                
                document.getElementById('map-info').textContent = `åœ°åœ–: ${info.maps.join(', ')}`;
                document.getElementById('time-info').textContent = `é‡ç”Ÿæ™‚é–“: ${formatTimeRange(info.min, info.max)}`;
                bossInfoCard.style.display = 'block';
                
                bossInfoTimer = setTimeout(() => {
                    bossInfoCard.style.display = 'none';
                }, 10000);
            } else {
                bossInfoCard.style.display = 'none';
                mapSelectContainer.style.display = 'none';
                previewImage.style.display = 'none';
            }
        }

        // è¨˜éŒ„BOSSæ“Šæ®º
        function recordBoss() {
            const bossName = document.getElementById('boss-select').value;
            const channel = document.getElementById('channel-input').value;
            const notification = true;

            if (!bossName) {
                showNotification('è«‹é¸æ“‡BOSS', 'warning');
                return;
            }

            if (!channel) {
                showNotification('è«‹è¼¸å…¥é »é“', 'warning');
                return;
            }

            const info = BOSS_DATA[bossName];
            const now = new Date();
            const respawnMin = new Date(now.getTime() + info.min * 60000);
            const respawnMax = new Date(now.getTime() + info.max * 60000);

            let mapLocation = info.maps[0];
            if (info.hasMapSelect) {
                const selectedMap = document.getElementById('map-select').value;
                mapLocation = selectedMap === '7' ? 'å¤œå¸‚å¾’æ­¥å€7' : 'å¤œå¸‚å¾’æ­¥å€7-1';
            }

            const existingRecordIndex = activeBosses.findIndex(
                b => b.bossName === bossName && b.channel === channel && b.map === mapLocation
            );

            if (existingRecordIndex !== -1) {
                const existingRecord = activeBosses[existingRecordIndex];
                existingRecord.deathTime = now.toISOString();
                existingRecord.respawnMin = respawnMin.toISOString();
                existingRecord.respawnMax = respawnMax.toISOString();
                existingRecord.notified = false;
                existingRecord.lastPatrolTime = null;
                
                updateBossStatistics(bossName);
                
                saveData();
                updateAllDisplays();

                // ç™¼é€ Discord é€šçŸ¥ï¼ˆæ•´åˆå€‹åˆ¥å’Œçµ±ä¸€ï¼‰
                // 1. å…ˆæª¢æŸ¥ä¸¦ç™¼é€å€‹åˆ¥ BOSS å°ˆå±¬çš„ Discord é€šçŸ¥
                if (typeof sendKillNotification === 'function') {
                    sendKillNotification(existingRecord).catch(err => {});
                }

                // 2. ç™¼é€ä½¿ç”¨è€…è¨­å®šçš„å€‹åˆ¥ BOSS Webhookï¼ˆå¦‚æœæœ‰è¨­å®šï¼‰
                sendIndividualBossWebhookNotification(existingRecord).catch(err => {});

                // 3. ç™¼é€ä½¿ç”¨è€…è‡ªè¨‚çš„çµ±ä¸€ Webhook é€šçŸ¥ï¼ˆå¦‚æœæœ‰è¨­å®šï¼Œç„¡è«–å€‹åˆ¥æ˜¯å¦æœ‰è¨­å®šéƒ½æœƒç™¼é€ï¼‰
                sendUserWebhookNotification(existingRecord).catch(err => {});

                showNotification(
                    `é »é“ ${channel} - ${bossName}\nåœ°åœ–: ${mapLocation}\nå·²æ›´æ–°æ“Šæ®ºæ™‚é–“ï¼\né è¨ˆé‡ç”Ÿ: ${formatTime(respawnMin)} ~ ${formatTime(respawnMax)}`,
                    'success'
                );
            } else {
                const record = {
                    id: Date.now(),
                    channel: channel,
                    bossName: bossName,
                    map: mapLocation,
                    deathTime: now.toISOString(),
                    respawnMin: respawnMin.toISOString(),
                    respawnMax: respawnMax.toISOString(),
                    notified: false,
                    notificationEnabled: notification,
                    lastPatrolTime: null
                };

                activeBosses.push(record);
                
                updateBossStatistics(bossName);
                
                saveData();
                updateAllDisplays();

                // ç™¼é€ Discord é€šçŸ¥ï¼ˆæ•´åˆå€‹åˆ¥å’Œçµ±ä¸€ï¼‰
                // 1. å…ˆæª¢æŸ¥ä¸¦ç™¼é€å€‹åˆ¥ BOSS å°ˆå±¬çš„ Discord é€šçŸ¥
                if (typeof sendKillNotification === 'function') {
                    sendKillNotification(record).catch(err => {});
                }

                // 2. ç™¼é€ä½¿ç”¨è€…è¨­å®šçš„å€‹åˆ¥ BOSS Webhookï¼ˆå¦‚æœæœ‰è¨­å®šï¼‰
                sendIndividualBossWebhookNotification(record).catch(err => {});

                // 3. ç™¼é€ä½¿ç”¨è€…è‡ªè¨‚çš„çµ±ä¸€ Webhook é€šçŸ¥ï¼ˆå¦‚æœæœ‰è¨­å®šï¼Œç„¡è«–å€‹åˆ¥æ˜¯å¦æœ‰è¨­å®šéƒ½æœƒç™¼é€ï¼‰
                sendUserWebhookNotification(record).catch(err => {});

                showNotification(
                    `é »é“ ${channel} - ${bossName}\nåœ°åœ–: ${mapLocation}\næ“Šæ®ºæ™‚é–“å·²è¨˜éŒ„ï¼\né è¨ˆé‡ç”Ÿ: ${formatTime(respawnMin)} ~ ${formatTime(respawnMax)}`,
                    'success'
                );
            }

            document.getElementById('channel-input').value = '';
            document.getElementById('channel-input').focus();
        }

        // åˆªé™¤å–®å€‹è¨˜éŒ„
        function deleteRecord(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤è¨˜éŒ„å—ï¼Ÿ')) {
                activeBosses = activeBosses.filter(b => b.id !== id);
                saveData();
                updateAllDisplays();
                showNotification('å·²åˆªé™¤BOSSè¨˜éŒ„', 'success');
            }
        }

        // é‡æ–°è¨ˆæ™‚å–®å€‹BOSS
        function respawnSingleBoss(id) {
            const record = activeBosses.find(b => b.id === id);
            if (record) {
                const info = BOSS_DATA[record.bossName];
                const now = new Date();
                record.deathTime = now.toISOString();
                record.respawnMin = new Date(now.getTime() + info.min * 60000).toISOString();
                record.respawnMax = new Date(now.getTime() + info.max * 60000).toISOString();
                record.notified = false;
                
                updateBossStatistics(record.bossName);
                
                saveData();
                updateAllDisplays();
                
                // ç™¼é€ Discord é€šçŸ¥ï¼ˆæ•´åˆå€‹åˆ¥å’Œçµ±ä¸€ï¼‰
                // 1. å…ˆæª¢æŸ¥ä¸¦ç™¼é€å€‹åˆ¥ BOSS å°ˆå±¬çš„ Discord é€šçŸ¥
                if (typeof sendKillNotification === 'function') {
                    sendKillNotification(record).catch(err => {});
                }

                // 2. ç™¼é€ä½¿ç”¨è€…è¨­å®šçš„å€‹åˆ¥ BOSS Webhookï¼ˆå¦‚æœæœ‰è¨­å®šï¼‰
                sendIndividualBossWebhookNotification(record).catch(err => {});

                // 3. ç™¼é€ä½¿ç”¨è€…è‡ªè¨‚çš„çµ±ä¸€ Webhook é€šçŸ¥ï¼ˆå¦‚æœæœ‰è¨­å®šï¼Œç„¡è«–å€‹åˆ¥æ˜¯å¦æœ‰è¨­å®šéƒ½æœƒç™¼é€ï¼‰
                sendUserWebhookNotification(record).catch(err => {});
                
                showNotification(`å·²é‡æ–°è¨ˆæ™‚ ${record.bossName}ï¼`, 'success');
            }
        }

        // å·¡é‚æ‰“å¡å–®å€‹BOSS
        function patrolSingleBoss(id) {
            const record = activeBosses.find(b => b.id === id);
            if (record) {
                const now = new Date();
                record.lastPatrolTime = now.toISOString();
                
                patrolRecords.push({
                    timestamp: now.toISOString(),
                    bossName: record.bossName,
                    channel: record.channel,
                    map: record.map,
                    result: 'æœªé‡ç”Ÿ',
                    note: 'å¾BOSSè¨˜éŒ„å·¡é‚æ‰“å¡'
                });

                saveData();
                updateAllDisplays();
                showNotification(
                    `å·¡é‚æ‰“å¡è¨˜éŒ„å·²å„²å­˜ï¼\nBOSS: ${record.bossName}\né »é“: ${record.channel}\nåœ°åœ–: ${record.map}`,
                    'success'
                );
            }
        }

        // æ¸…ç©ºæ‰€æœ‰è¨˜éŒ„
        function clearAll() {
            if (activeBosses.length === 0) {
                showNotification('ç›®å‰æ²’æœ‰è¨˜éŒ„', 'warning');
                return;
            }

            if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰BOSSè¨˜éŒ„å—ï¼Ÿ')) {
                activeBosses = [];
                saveData();
                updateAllDisplays();
                showNotification('å·²æ¸…ç©ºæ‰€æœ‰è¨˜éŒ„', 'success');
            }
        }

        // æ¸…ç©ºå»ºè­°è¡¨å–®
        function clearFeedbackForm() {
            document.getElementById('feedback-type').value = 'åŠŸèƒ½å»ºè­°';
            document.getElementById('feedback-content').value = '';
            document.getElementById('feedback-contact').value = '';
        }

        // ===== ç”¨æˆ¶ Webhook ç®¡ç†å‡½æ•¸ =====
        
        // è¼‰å…¥ç”¨æˆ¶ Webhook
        function loadUserWebhook() {
            const savedWebhook = localStorage.getItem('userDiscordWebhook');
            if (savedWebhook) {
                document.getElementById('user-webhook-url').value = savedWebhook;
                showWebhookStatus('âœ… å·²è¼‰å…¥å„²å­˜çš„ Webhook è¨­å®š', 'success');
            }
        }

        // ===== å€‹åˆ¥ BOSS Webhook ç®¡ç†å‡½æ•¸ =====

        // è¼‰å…¥å€‹åˆ¥ BOSS Webhook è¨­å®š
        function loadIndividualWebhooks() {
            const saved = localStorage.getItem('individualBossWebhooks');
            let individualWebhooks = {};
            
            if (saved) {
                try {
                    individualWebhooks = JSON.parse(saved);
                } catch (e) {
                    console.error('è¼‰å…¥å€‹åˆ¥ Webhook å¤±æ•—:', e);
                }
            }
            
            return individualWebhooks;
        }

        // å„²å­˜å€‹åˆ¥ BOSS Webhook è¨­å®š
        function saveIndividualWebhooks(webhooks) {
            localStorage.setItem('individualBossWebhooks', JSON.stringify(webhooks));
        }

        // ç”Ÿæˆå€‹åˆ¥ BOSS Webhook åˆ—è¡¨
        function populateBossWebhooksList() {
            const container = document.getElementById('boss-webhooks-list');
            const individualWebhooks = loadIndividualWebhooks();
            
            let html = '';
            let configuredCount = 0;
            let totalCount = 0;

            Object.entries(BOSS_DATA).forEach(([bossName, info]) => {
                totalCount++;
                const webhookUrl = individualWebhooks[bossName] || '';
                const isConfigured = webhookUrl ? 'webhook-configured' : '';
                if (webhookUrl) configuredCount++;

                const bossImageHtml = info.image 
                    ? `<img src="${info.image}" alt="${bossName}" class="boss-image">` 
                    : `<span style="color: ${info.color}; font-size: 2em;">â—</span>`;

                html += `
                    <div class="boss-webhook-card ${isConfigured}" id="boss-webhook-${bossName.replace(/\s/g, '-')}">
                        <div class="boss-webhook-info">
                            ${bossImageHtml}
                            <div>
                                <div style="font-weight: bold; color: #e2e8f0;">${bossName}</div>
                                <div style="font-size: 0.85em; color: #94a3b8;">${info.maps[0]}</div>
                            </div>
                        </div>
                        <div class="boss-webhook-input">
                            <input type="text" 
                                   id="webhook-${bossName}" 
                                   value="${webhookUrl}"
                                   placeholder="https://discord.com/api/webhooks/..."
                                   style="width: 100%;">
                        </div>
                        <div class="boss-webhook-actions">
                            <button type="button" 
                                    class="boss-webhook-btn" 
                                    onclick="testSingleBossWebhook('${bossName}')"
                                    style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-color: #f59e0b;">
                                ğŸ§ª æ¸¬è©¦
                            </button>
                            <button type="button" 
                                    class="boss-webhook-btn" 
                                    onclick="clearSingleBossWebhook('${bossName}')"
                                    style="background: rgba(220, 38, 38, 0.2); border-color: rgba(220, 38, 38, 0.5); color: #fca5a5;">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            
            // æ›´æ–°è¨ˆæ•¸
            document.getElementById('individual-webhook-count').textContent = configuredCount;
            document.getElementById('total-boss-count').textContent = totalCount;
        }

        // åˆ‡æ›å€‹åˆ¥ Webhook å€å¡Šé¡¯ç¤º
        function toggleIndividualWebhooks() {
            const container = document.getElementById('individual-webhooks-container');
            const btn = document.getElementById('toggle-individual-btn');
            
            if (container.style.display === 'none') {
                container.style.display = 'block';
                btn.innerHTML = 'ğŸ“ æ”¶èµ·è¨­å®š';
                populateBossWebhooksList();
            } else {
                container.style.display = 'none';
                btn.innerHTML = 'ğŸ“‚ å±•é–‹è¨­å®š';
            }
        }

        // å„²å­˜æ‰€æœ‰å€‹åˆ¥ Webhook è¨­å®š
        function saveAllIndividualWebhooks() {
            const individualWebhooks = {};
            let savedCount = 0;

            Object.keys(BOSS_DATA).forEach(bossName => {
                const input = document.getElementById(`webhook-${bossName}`);
                if (input) {
                    const url = input.value.trim();
                    if (url) {
                        // é©—è­‰ URL æ ¼å¼
                        if (url.startsWith('https://discord.com/api/webhooks/') || 
                            url.startsWith('https://discordapp.com/api/webhooks/')) {
                            individualWebhooks[bossName] = url;
                            savedCount++;
                        } else {
                            showNotification(`${bossName} çš„ Webhook URL æ ¼å¼ä¸æ­£ç¢º`, 'warning');
                            return;
                        }
                    }
                }
            });

            saveIndividualWebhooks(individualWebhooks);
            populateBossWebhooksList(); // é‡æ–°è¼‰å…¥ä»¥æ›´æ–° âœ… æ¨™è¨˜
            showNotification(`âœ… å·²å„²å­˜ ${savedCount} å€‹ BOSS çš„ Webhook è¨­å®š`, 'success');
            showWebhookStatus(`âœ… å·²å„²å­˜ ${savedCount} å€‹ BOSS çš„å€‹åˆ¥ Webhook è¨­å®š`, 'success');
        }

        // æ¸¬è©¦å–®å€‹ BOSS çš„ Webhook
        async function testSingleBossWebhook(bossName) {
            const input = document.getElementById(`webhook-${bossName}`);
            const webhookUrl = input.value.trim();

            if (!webhookUrl) {
                showNotification(`è«‹å…ˆè¼¸å…¥ ${bossName} çš„ Webhook URL`, 'warning');
                return;
            }

            // é©—è­‰ URL æ ¼å¼
            if (!webhookUrl.startsWith('https://discord.com/api/webhooks/') && 
                !webhookUrl.startsWith('https://discordapp.com/api/webhooks/')) {
                showNotification(`${bossName} çš„ Webhook URL æ ¼å¼ä¸æ­£ç¢º`, 'error');
                return;
            }

            const now = new Date();
            const bossInfo = BOSS_DATA[bossName];
            const testEmbed = {
                title: 'ğŸ§ª æ¸¬è©¦é€šçŸ¥ - ' + bossName,
                description: `é€™æ˜¯ **${bossName}** çš„æ¸¬è©¦é€šçŸ¥`,
                color: parseInt(bossInfo.color.replace('#', ''), 16),
                fields: [
                    {
                        name: 'ğŸ“… æ¸¬è©¦æ™‚é–“',
                        value: formatDateTime(now),
                        inline: true
                    },
                    {
                        name: 'ğŸ—ºï¸ åœ°åœ–',
                        value: bossInfo.maps[0],
                        inline: true
                    }
                ],
                timestamp: now.toISOString(),
                footer: {
                    text: `æ¥“ä¹‹è°·BOSSé‡ç”Ÿæ™‚é–“ç³»çµ± - ${bossName} å°ˆå±¬é€šçŸ¥`
                }
            };

            try {
                showNotification(`æ­£åœ¨ç™¼é€ ${bossName} çš„æ¸¬è©¦é€šçŸ¥...`, 'success');
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        embeds: [testEmbed]
                    })
                });

                if (response.ok) {
                    showNotification(`âœ… ${bossName} çš„æ¸¬è©¦é€šçŸ¥å·²æˆåŠŸç™¼é€ï¼`, 'success');
                    
                    // æ¨™è¨˜ç‚ºå·²è¨­å®š
                    const card = document.getElementById(`boss-webhook-${bossName.replace(/\s/g, '-')}`);
                    if (card && !card.classList.contains('webhook-configured')) {
                        card.classList.add('webhook-configured');
                    }
                } else {
                    showNotification(`âŒ ${bossName} çš„æ¸¬è©¦å¤±æ•—`, 'error');
                }
            } catch (error) {
                console.error(`${bossName} Webhook æ¸¬è©¦å¤±æ•—:`, error);
                showNotification(`âŒ ${bossName} ç™¼é€å¤±æ•—`, 'error');
            }
        }

        // æ¸…é™¤å–®å€‹ BOSS çš„ Webhook
        function clearSingleBossWebhook(bossName) {
            const input = document.getElementById(`webhook-${bossName}`);
            if (input) {
                input.value = '';
                const card = document.getElementById(`boss-webhook-${bossName.replace(/\s/g, '-')}`);
                if (card) {
                    card.classList.remove('webhook-configured');
                }
                
                // å¾å„²å­˜ä¸­ç§»é™¤
                const individualWebhooks = loadIndividualWebhooks();
                delete individualWebhooks[bossName];
                saveIndividualWebhooks(individualWebhooks);
                
                populateBossWebhooksList(); // æ›´æ–°è¨ˆæ•¸
                showNotification(`å·²æ¸…é™¤ ${bossName} çš„ Webhook è¨­å®š`, 'success');
            }
        }

        // æ¸…é™¤æ‰€æœ‰å€‹åˆ¥ Webhook
        function clearAllIndividualWebhooks() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å€‹åˆ¥ BOSS çš„ Webhook è¨­å®šå—ï¼Ÿ')) {
                localStorage.removeItem('individualBossWebhooks');
                populateBossWebhooksList();
                showNotification('å·²æ¸…é™¤æ‰€æœ‰å€‹åˆ¥ BOSS çš„ Webhook è¨­å®š', 'success');
                showWebhookStatus('â„¹ï¸ æ‰€æœ‰å€‹åˆ¥ BOSS çš„ Webhook è¨­å®šå·²æ¸…é™¤', 'warning');
            }
        }

        // ç™¼é€å€‹åˆ¥ BOSS çš„ Webhook é€šçŸ¥ï¼ˆå„ªå…ˆç´šé«˜æ–¼çµ±ä¸€é€šçŸ¥ï¼‰
        async function sendIndividualBossWebhookNotification(record) {
            const individualWebhooks = loadIndividualWebhooks();
            const webhookUrl = individualWebhooks[record.bossName];
            
            if (!webhookUrl) return false; // æ²’æœ‰è¨­å®šå°±è¿”å› false

            const deathTime = new Date(record.deathTime);
            const respawnMin = new Date(record.respawnMin);
            const respawnMax = new Date(record.respawnMax);

            const embed = {
                title: 'âš”ï¸ BOSSæ“Šæ®ºè¨˜éŒ„',
                description: `**${record.bossName}** å·²è¢«æ“Šæ®ºï¼`,
                color: parseInt(BOSS_DATA[record.bossName]?.color?.replace('#', '') || 'FF0000', 16),
                fields: [
                    {
                        name: 'é »é“',
                        value: String(record.channel),
                        inline: true
                    },
                    {
                        name: 'åœ°åœ–',
                        value: record.map || BOSS_DATA[record.bossName]?.map || 'æœªçŸ¥',
                        inline: true
                    },
                    {
                        name: 'â° é è¨ˆé‡ç”Ÿæ™‚é–“',
                        value: `**${formatDateTime(respawnMin)} ~ ${formatDateTime(respawnMax)}**`,
                        inline: false
                    }
                ],
                timestamp: new Date().toISOString(),
                footer: {
                    text: `æ¥“ä¹‹è°·BOSSé‡ç”Ÿæ™‚é–“ç³»çµ± - ${record.bossName} å°ˆå±¬é€šçŸ¥`
                }
            };

            try {
                await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        embeds: [embed]
                    })
                });
                return true; // ç™¼é€æˆåŠŸ
            } catch (error) {
                console.error(`${record.bossName} å€‹åˆ¥ Webhook ç™¼é€å¤±æ•—:`, error);
                return false; // ç™¼é€å¤±æ•—
            }
        }

        // å„²å­˜ç”¨æˆ¶ Webhook
        function saveUserWebhook() {
            const webhookUrl = document.getElementById('user-webhook-url').value.trim();
            
            if (!webhookUrl) {
                showNotification('è«‹è¼¸å…¥ Webhook URL', 'warning');
                return;
            }

            // é©—è­‰ Webhook URL æ ¼å¼
            if (!webhookUrl.startsWith('https://discord.com/api/webhooks/') && 
                !webhookUrl.startsWith('https://discordapp.com/api/webhooks/')) {
                showNotification('è«‹è¼¸å…¥æ­£ç¢ºçš„ Discord Webhook URL', 'error');
                showWebhookStatus('âŒ URL æ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹ç¢ºèªæ˜¯å¦ç‚º Discord Webhook ç¶²å€', 'error');
                return;
            }

            localStorage.setItem('userDiscordWebhook', webhookUrl);
            showNotification('âœ… Webhook å·²å„²å­˜ï¼', 'success');
            showWebhookStatus('âœ… Webhook è¨­å®šå·²æˆåŠŸå„²å­˜ï¼Œç¾åœ¨è¨˜éŒ„ BOSS æ™‚æœƒè‡ªå‹•ç™¼é€é€šçŸ¥åˆ°æ‚¨çš„ Discord é »é“', 'success');
        }

        // æ¸¬è©¦ç”¨æˆ¶ Webhook
        async function testUserWebhook() {
            const webhookUrl = document.getElementById('user-webhook-url').value.trim();
            
            if (!webhookUrl) {
                showNotification('è«‹å…ˆè¼¸å…¥ä¸¦å„²å­˜ Webhook URL', 'warning');
                return;
            }

            const now = new Date();
            const testEmbed = {
                title: 'ğŸ§ª æ¸¬è©¦é€šçŸ¥',
                description: 'é€™æ˜¯ä¸€å‰‡æ¸¬è©¦è¨Šæ¯ï¼Œå¦‚æœæ‚¨çœ‹åˆ°é€™å‰‡è¨Šæ¯ï¼Œè¡¨ç¤º Webhook è¨­å®šæˆåŠŸï¼',
                color: 0x10b981,
                fields: [
                    {
                        name: 'ğŸ“… æ¸¬è©¦æ™‚é–“',
                        value: formatDateTime(now),
                        inline: true
                    },
                    {
                        name: 'âœ… ç‹€æ…‹',
                        value: 'è¨­å®šæ­£å¸¸',
                        inline: true
                    }
                ],
                timestamp: now.toISOString(),
                footer: {
                    text: 'æ¥“ä¹‹è°·BOSSé‡ç”Ÿæ™‚é–“ç³»çµ± - æ¸¬è©¦é€šçŸ¥'
                }
            };

            try {
                showNotification('æ­£åœ¨ç™¼é€æ¸¬è©¦é€šçŸ¥...', 'success');
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        embeds: [testEmbed]
                    })
                });

                if (response.ok) {
                    showNotification('âœ… æ¸¬è©¦é€šçŸ¥å·²æˆåŠŸç™¼é€ï¼è«‹æª¢æŸ¥æ‚¨çš„ Discord é »é“', 'success');
                    showWebhookStatus('âœ… æ¸¬è©¦æˆåŠŸï¼å·²ç™¼é€æ¸¬è©¦è¨Šæ¯åˆ°æ‚¨çš„ Discord é »é“', 'success');
                } else {
                    const errorText = await response.text();
                    console.error('Webhook æ¸¬è©¦å¤±æ•—:', response.status, errorText);
                    showNotification('âŒ æ¸¬è©¦å¤±æ•—ï¼Œè«‹æª¢æŸ¥ Webhook URL æ˜¯å¦æ­£ç¢º', 'error');
                    showWebhookStatus(`âŒ æ¸¬è©¦å¤±æ•— (éŒ¯èª¤ä»£ç¢¼: ${response.status})ï¼Œè«‹ç¢ºèª Webhook URL æ˜¯å¦æ­£ç¢º`, 'error');
                }
            } catch (error) {
                console.error('ç™¼é€æ¸¬è©¦é€šçŸ¥æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                showNotification('âŒ ç™¼é€å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š', 'error');
                showWebhookStatus('âŒ ç™¼é€å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ– Webhook URL æ˜¯å¦æ­£ç¢º', 'error');
            }
        }

        // æ¸…é™¤ç”¨æˆ¶ Webhook
        function clearUserWebhook() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤ Webhook è¨­å®šå—ï¼Ÿ')) {
                localStorage.removeItem('userDiscordWebhook');
                document.getElementById('user-webhook-url').value = '';
                showNotification('å·²æ¸…é™¤ Webhook è¨­å®š', 'success');
                showWebhookStatus('â„¹ï¸ Webhook è¨­å®šå·²æ¸…é™¤', 'warning');
            }
        }

        // é¡¯ç¤º Webhook ç‹€æ…‹è¨Šæ¯
        function showWebhookStatus(message, type) {
            const statusDiv = document.getElementById('webhook-status');
            const statusText = document.getElementById('webhook-status-text');
            
            statusText.textContent = message;
            statusDiv.style.display = 'block';
            
            // æ ¹æ“šé¡å‹è¨­å®šæ¨£å¼
            if (type === 'success') {
                statusDiv.style.background = 'rgba(16, 185, 129, 0.1)';
                statusDiv.style.borderLeftColor = '#10b981';
                statusText.style.color = '#34d399';
            } else if (type === 'error') {
                statusDiv.style.background = 'rgba(239, 68, 68, 0.1)';
                statusDiv.style.borderLeftColor = '#ef4444';
                statusText.style.color = '#f87171';
            } else if (type === 'warning') {
                statusDiv.style.background = 'rgba(245, 158, 11, 0.1)';
                statusDiv.style.borderLeftColor = '#f59e0b';
                statusText.style.color = '#fbbf24';
            }

            // 5ç§’å¾Œè‡ªå‹•éš±è—ï¼ˆé™¤éæ˜¯éŒ¯èª¤è¨Šæ¯ï¼‰
            if (type !== 'error') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }

        // ç™¼é€ç”¨æˆ¶ Webhook é€šçŸ¥
        async function sendUserWebhookNotification(record) {
            const webhookUrl = localStorage.getItem('userDiscordWebhook');
            if (!webhookUrl) return; // å¦‚æœæ²’æœ‰è¨­å®šå°±ä¸ç™¼é€

            const deathTime = new Date(record.deathTime);
            const respawnMin = new Date(record.respawnMin);
            const respawnMax = new Date(record.respawnMax);

            const embed = {
                title: 'âš”ï¸ BOSSæ“Šæ®ºè¨˜éŒ„',
                description: `**${record.bossName}** å·²è¢«æ“Šæ®ºï¼`,
                color: parseInt(BOSS_DATA[record.bossName]?.color?.replace('#', '') || 'FF0000', 16),
                fields: [
                    {
                        name: 'é »é“',
                        value: String(record.channel),
                        inline: true
                    },
                    {
                        name: 'åœ°åœ–',
                        value: record.map || BOSS_DATA[record.bossName]?.map || 'æœªçŸ¥',
                        inline: true
                    },
                    {
                        name: 'â° é è¨ˆé‡ç”Ÿæ™‚é–“',
                        value: `**${formatDateTime(respawnMin)} ~ ${formatDateTime(respawnMax)}**`,
                        inline: false
                    }
                ],
                timestamp: new Date().toISOString(),
                footer: {
                    text: 'æ¥“ä¹‹è°·BOSSé‡ç”Ÿæ™‚é–“ç³»çµ±'
                }
            };

            try {
                await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        embeds: [embed]
                    })
                });
                // éœé»˜è™•ç†ï¼Œä¸é¡¯ç¤ºé€šçŸ¥
            } catch (error) {
                // éœé»˜è™•ç†éŒ¯èª¤
                console.error('ç”¨æˆ¶ Webhook ç™¼é€å¤±æ•—:', error);
            }
        }

        // æ›´æ–°æ‰€æœ‰é¡¯ç¤º
        function updateAllDisplays() {
            checkAndResetDailyStats();
            updateRecordDisplay();
            updateStatisticsDisplay();
        }

        // æ›´æ–°è¨˜éŒ„é¡¯ç¤º
        function updateRecordDisplay() {
            const container = document.getElementById('record-container');
            const now = new Date();
            
            document.getElementById('boss-count').textContent = activeBosses.length;

            if (activeBosses.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #a0a0c0; padding: 40px 0;">ç›®å‰æ²’æœ‰è¨˜éŒ„ä¸­çš„BOSS</p>';
                return;
            }

            const sorted = [...activeBosses].sort((a, b) => 
                new Date(a.respawnMin) - new Date(b.respawnMin)
            );

            let html = '';
            sorted.forEach(record => {
                const respawnMin = new Date(record.respawnMin);
                const respawnMax = new Date(record.respawnMax);
                const bossInfo = BOSS_DATA[record.bossName];
                const bossColor = bossInfo ? bossInfo.color : '#0099cc';
                
                let statusText = '';
                let statusClass = '';
                let countdownText = '';
                let showRespawnBtn = false;
                let showPatrolBtn = false;
                
                if (now < respawnMin) {
                    statusText = 'å³å°‡é‡ç”Ÿ';
                    statusClass = 'waiting';
                    
                    const totalSeconds = Math.floor((respawnMin - now) / 1000);
                    const hours = Math.floor(totalSeconds / 3600);
                    const minutes = Math.floor((totalSeconds % 3600) / 60);
                    const seconds = totalSeconds % 60;
                    countdownText = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                } else if (now >= respawnMin && now <= respawnMax) {
                    statusText = 'å¯èƒ½é‡ç”Ÿ';
                    statusClass = 'possible';
                    showRespawnBtn = true;
                    showPatrolBtn = true;
                    
                    const totalSeconds = Math.floor((respawnMax - now) / 1000);
                    const hours = Math.floor(totalSeconds / 3600);
                    const minutes = Math.floor((totalSeconds % 3600) / 60);
                    const seconds = totalSeconds % 60;
                    countdownText = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                } else {
                    statusText = 'ç¢ºå®šé‡ç”Ÿ';
                    statusClass = 'confirmed';
                    showRespawnBtn = true;
                    
                    const diffMin = Math.floor((now - respawnMax) / 60000);
                    countdownText = `+${diffMin}åˆ†`;
                }

                const mapInfo = record.map ? ` | ${record.map}` : '';
                const killTime = formatDateTime(new Date(record.deathTime));
                
                let patrolInfo = '';
                if (record.lastPatrolTime) {
                    const diff = Math.floor((now - new Date(record.lastPatrolTime)) / 60000);
                    patrolInfo = `
                        <div class="boss-info-item">
                            <span style="color: #64748b;">|</span>
                            <span>ğŸ‘€ å·¡é‚: ${diff}åˆ†é˜å‰</span>
                        </div>
                    `;
                }

                const respawnBtnHtml = showRespawnBtn ? `<button type="button" class="boss-icon-btn" onclick="respawnSingleBoss(${record.id})" title="é‡æ–°è¨ˆæ™‚">ğŸ”„</button>` : '';
                const patrolBtnHtml = showPatrolBtn ? `<button type="button" class="boss-icon-btn" onclick="patrolSingleBoss(${record.id})" title="å·¡é‚æ‰“å¡">ğŸ‘€</button>` : '';

                const bossImage = bossInfo && bossInfo.image ? `<img src="${bossInfo.image}" alt="${record.bossName}" class="boss-image">` : '';

                html += `
                    <div class="boss-status-card" style="--boss-color: ${bossColor};">
                        <div class="boss-card-header">
                            <div class="boss-info-left">
                                ${bossImage}
                                <div class="boss-info-row">
                                    <div class="boss-info-item">
                                        <span>é »é“ ${record.channel}${mapInfo}</span>
                                    </div>
                                    <div class="boss-info-item">
                                        <span style="color: #64748b;">|</span>
                                        <span>âš”ï¸ æ“Šæ®º: ${killTime}</span>
                                    </div>
                                    ${patrolInfo}
                                    <div class="boss-info-item">
                                        <span style="color: #64748b;">|</span>
                                        <span class="boss-status-badge ${statusClass}">${statusText}</span>
                                        <span style="font-family: 'Courier New', monospace; font-weight: 600;">${countdownText}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="boss-action-btns">
                                ${respawnBtnHtml}
                                ${patrolBtnHtml}
                                <button type="button" class="boss-icon-btn delete" onclick="deleteRecord(${record.id})" title="åˆªé™¤">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `<p style="white-space: pre-line;">${message}</p>`;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // åˆ‡æ›æ¨™ç±¤
        function switchTab(index) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));

            tabs[index].classList.add('active');
            contents[index].classList.add('active');
        }

        // æ ¼å¼åŒ–æ™‚é–“
        function formatTime(date) {
            return date.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit', hour12: false });
        }

        function formatDateTime(date, withSeconds = false) {
            const options = { 
                month: '2-digit', 
                day: '2-digit', 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false
            };
            if (withSeconds) {
                options.second = '2-digit';
            }
            return date.toLocaleString('zh-TW', options).replace(/\//g, '/');
        }

        // ä¿å­˜æ•¸æ“šåˆ°localStorage
        function saveData() {
            localStorage.setItem('activeBosses', JSON.stringify(activeBosses));
            localStorage.setItem('patrolRecords', JSON.stringify(patrolRecords));
            localStorage.setItem('bossStatistics', JSON.stringify(bossStatistics));
        }

        // è¼‰å…¥æ•¸æ“š
        function loadData() {
            const savedBosses = localStorage.getItem('activeBosses');
            const savedPatrols = localStorage.getItem('patrolRecords');
            const savedStatistics = localStorage.getItem('bossStatistics');

            if (savedBosses) {
                try {
                    activeBosses = JSON.parse(savedBosses);
                } catch (e) {
                    console.error('è¼‰å…¥BOSSæ•¸æ“šå¤±æ•—:', e);
                }
            }

            if (savedPatrols) {
                try {
                    patrolRecords = JSON.parse(savedPatrols);
                } catch (e) {
                    console.error('è¼‰å…¥å·¡é‚è¨˜éŒ„å¤±æ•—:', e);
                }
            }

            if (savedStatistics) {
                try {
                    bossStatistics = JSON.parse(savedStatistics);
                } catch (e) {
                    console.error('è¼‰å…¥çµ±è¨ˆæ•¸æ“šå¤±æ•—:', e);
                    bossStatistics = {};
                }
            }
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', init);
        
        // æŒ‰ Enter éµè¨˜éŒ„æ“Šæ®º
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                recordBoss();
            }
        });
    </script>
</body>
</html>
